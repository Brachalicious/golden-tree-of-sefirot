<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Golden Tree of Sefirot</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer>
    // START OF CHATBOT AND INTERACTIVITY JAVASCRIPT CODE - HYBRID SYSTEM
    document.addEventListener("DOMContentLoaded", () => {
      const chatInput = document.getElementById("chat-input");
      const chatContent = document.getElementById("chat-content");
      const popupBox = document.getElementById("popupBox");
      const popupText = document.getElementById("popupText");
      const chatbotLoading = document.getElementById("chatbot-loading");
      let currentOpen = null;

      // Full Sefirah content - "Associated Aleph Bet" updated to reflect YOUR path mapping
      const contentMapSefirah = {
        Keter: `<strong>Keter (Crown)</strong><br/>The highest Sefirah, representing divine will, pure consciousness, and infinite light. It is the primordial point beyond human comprehension, the source of all emanation.<br/><br/><strong>Associated Angels:</strong> Chayot HaKodesh (Holy Living Creatures), Seraphim.<br/><strong>Associated Aleph Bet:</strong> Dalet (×“), Heh (×”), or Vav (×•) â€“ letters connecting Keter to other Sefirot, showing divine emanation.<br/><strong>Associated Constellations:</strong> Beyond specific constellations, as Keter transcends the manifest universe.`,
        Chochmah: `<strong>Chochmah (Wisdom)</strong><br/>The first flash of an idea, pure undifferentiated wisdom, the point of emanation from Keter. It is the initial spark of creation, often associated with the 'Father' principle.<br/><br/><strong>Associated Angels:</strong> Ophanim (Wheels), also known as the Erelim.<br/><strong>Associated Aleph Bet:</strong> Shin (×©), Bet (×‘), Zayin (×–), or Tet (×˜) â€“ letters on paths connected to Chochmah, revealing aspects of its wisdom.<br/><strong>Associated Constellations:</strong> Mazalot (general term for constellations), as Chochmah is the source of astrological influence and cosmic order.`,
        Binah: `<strong>Binah (Understanding)</strong><br/>The expansion of Chochmah into detailed understanding, giving form and structure to the initial idea. It represents divine motherly nurturing, discernment, and the 'Mother' principle. It is one of the 'Three Mothers' along with Keter and Chochmah, forming the intellectual triad.<br/><br/><strong>Associated Angels:</strong> Aralim (Thrones), also known as the Cherubim.<br/><strong>Associated Aleph Bet:</strong> Gimel (×’), Vav (×•), Ayin (×¢), Kuf (×§), or Shin (×©) â€“ letters on paths connected to Binah, emphasizing its form-giving and understanding aspects.<br/><br/><strong>Associated Constellations:</strong> Tehom (Deep, Abyss), related to primordial waters and the vastness of understanding.`,
        Chesed: `<strong>Chesed (Loving-kindness)</strong><br/>Expansive love, boundless grace, mercy, and benevolence. It is the outpouring of divine goodness, extending without limit, often associated with the 'Greatness' of God.<br/><br/><strong>Associated Angels:</strong> Chashmalim (Brilliant Ones/Amber), also known as Dominions.<br/><strong>Associated Aleph Bet:</strong> Aleph (×), Bet (×‘), Chet (×—), or Kaf (×›) â€“ letters on paths connected to Chesed, reflecting its expansive and loving qualities.<br/><br/><strong>Associated Constellations:</strong> Jupiter, representing expansion, abundance, and beneficence.`,
        Gevurah: `<strong>Gevurah (Strength/Justice)</strong><br/>Restraint, discipline, judgment, and severity. It limits Chesed, providing structure for balance and justice in creation. Often associated with the 'Might' of God.<br/><br/><strong>Associated Angels:</strong> Seraphim (Fiery Ones), also known as Powers.<br/><br/><strong>Associated Aleph Bet:</strong> Aleph (×), Gimel (×’), Zayin (×–), Peh (×¤), or Tzadi (×¦) â€“ letters on paths connected to Gevurah, highlighting its power and discernment.<br/><br/><strong>Associated Constellations:</strong> Mars, representing strength, discipline, and sometimes conflict.`,
        Tiferet: `<strong>Tiferet (Beauty)</strong><br/>Harmony, compassion, truth, and balance. It is the central Sefirah, reconciling Chesed and Gevurah, and is often associated with the 'Son' or 'King' principle. It represents the beauty of God's perfect balance.<br/><br/><strong>Associated Angels:</strong> Shinanim (Burning Flames), also known as Virtues.<br/><br/><strong>Associated Aleph Bet:</strong> Dalet (×“), Chet (×—), Tet (×˜), Yud (×™), Samech (×¡), Ayin (×¢), Tzadi (×¦), or Resh (×¨) â€“ letters on paths connected to Tiferet, emphasizing its central balancing role.<br/><br/><strong>Associated Constellations:</strong> Sun, representing illumination, centrality, and life-giving energy.`,
        Netzach: `<strong>Netzach (Eternity/Victory)</strong><br/>Endurance, perseverance, victory, and divine triumph. It represents the drive to overcome obstacles and achieve goals, the 'Eternity' of God.<br/><br/><strong>Associated Angels:</strong> Tarshishim (Sparkling Ones), also known as Principalities.<br/><br/><strong>Associated Aleph Bet:</strong> Yud (×™), Kaf (×›), Mem (×), or Nun (× ) â€“ letters on paths connected to Netzach, reflecting its enduring and conquering nature.<br/><br/><strong>Associated Constellations:</strong> Venus, representing victory, love, and enduring beauty.`,
        Hod: `<strong>Hod (Splendor/Glory)</strong><br/>Humility, surrender, resonance, and divine glory. It is the receptive counterpart to Netzach, acknowledging the source of power, the 'Glory' of God.<br/><br/><strong>Associated Angels:</strong> Beni Elohim (Sons of God), also known as Archangels.<br/><br/><strong>Associated Aleph Bet:</strong> Lamed (×œ), Mem (×), Peh (×¤), or Ayin (×¢) â€“ letters on paths connected to Hod, signifying its reflective and receptive qualities.<br/><br/><strong>Associated Constellations:</strong> Mercury, representing communication, intellect, and splendor.`,
        Yesod: `<strong>Yesod (Foundation)</strong><br/>Connection, foundation, bonding, and the transmission of divine energy to Malkuth. It is the channel through which all preceding Sefirot flow into manifestation, the 'Foundation' of all existence.<br/><br/><strong>Associated Angels:</strong> Cherubim (Strong Ones/Guardians), also known as Angels.<br/><br/><strong>Associated Aleph Bet:</strong> Lamed (×œ), Nun (× ), Resh (×¨), or Taf (×ª) â€“ letters on paths connected to Yesod, representing its foundational and connective role.<br/><br/><strong>Associated Constellations:</strong> Moon, representing foundation, cycles, and the receptacle of light.`,
        Malchut: `<strong>Malkuth (Kingdom/Presence)</strong><br/>The physical world, manifest reality, and the divine feminine presence (Shekhinah). It is the culmination of all divine emanations, where divinity is experienced in creation, the 'Kingdom' of God. It is also considered one of the 'Crossroads' in the Tree of Life, representing the horizontal links that balance energies.<br/><br/><strong>Associated Angels:</strong> Ishim (Souls of Fire/Men of God), also known as Aishim.<br/><br/><strong>Associated Aleph Bet:</strong> Taf (×ª) â€“ the letter on the path connecting Yesod to Malkuth, symbolizing truth and completion in manifestation.<br/><br/><strong>Associated Constellations:</strong> Earth, representing the physical realm, manifestation, and the culmination of all energies.`
      };

      // Content for Aleph-Bet letters on the paths based on YOUR custom mapping - Corrected Hebrew Letters
      const contentMapAlephBet = {
        '×': `<strong>Aleph (×): Path Gevurah to Chesed</strong><br/>Represents unity, the unmanifest, and the primal breath. On this path, Aleph signifies the balanced flow and interchange between restriction (Gevurah) and expansion (Chesed), allowing for harmonious manifestation.`,
        '×‘': `<strong>Bet (×‘): Path Chochmah to Chesed</strong><br/>Symbolizes a house or dwelling, embodying creation and duality. It represents the wisdom (Chochmah) beginning to manifest as boundless love and generosity (Chesed), providing a 'house' for divine emanation.`,
        '×’': `<strong>Gimmel (×’): Path Binah to Gevurah</strong><br/>Symbolizes a camel, signifying bridging and bestowing. This path highlights the application of understanding (Binah) in a way that leads to strength and precise judgment (Gevurah), guiding the flow of divine power with discernment.`,
        '×“': `<strong>Dalet (×“): Path Keter to Tiferet</strong><br/>Symbolizes a door, representing giving and humility. It depicts the direct descent of divine will (Keter) into beauty and harmony (Tiferet), acting as a conduit for the central expression of God's essence.`,
        '×”': `<strong>Heh (×”): Path Keter to Chochmah</strong><br/>Symbolizes a window or revelation, embodying breath and life. This path represents the initial burst of divine revelation from the utterly unknowable (Keter) into the first spark of wisdom (Chochmah), opening the way for creation.`,
        '×•': `<strong>Vav (×•): Path Keter to Binah</strong><br/>Symbolizes a nail or hook, signifying connection and integration. It links the divine will (Keter) to understanding and form (Binah), acting as the central pillar that stabilizes and connects abstract divine thought to concrete understanding.`,
        '×–': `<strong>Zayin (×–): Path Chochmah to Gevurah</strong><br/>Symbolizes a sword or weapon, representing discernment and conflict. This path shows how primal wisdom (Chochmah) can be channeled into focused strength and discipline (Gevurah), providing the 'cutting edge' of divine justice.`,
        '×—': `<strong>Chet (×—): Path Chesed to Tiferet</strong><br/>Symbolizes a fence or enclosure, signifying protection and inner sanctity. It connects boundless love (Chesed) to balanced beauty (Tiferet), illustrating the sacred space created by divine compassion that leads to harmony.`,
        '×˜': `<strong>Tet (×˜): Path Chochmah to Tiferet</strong><br/>Symbolizes a snake or spiral, denoting hidden goodness and inner strength. It connects wisdom (Chochmah) directly to beauty and harmony (Tiferet), revealing the concealed divine providence that works for the good within the central column.`,
        '×™': `<strong>Yud (×™): Path Tiferet to Netzach</strong><br/>Symbolizes a hand or a point, signifying divine emanation and action. It represents the active manifestation of balanced beauty (Tiferet) into enduring victory and persistence (Netzach), showing the divine hand in achieving goals.`,
        '×›': `<strong>Kaf (×›): Path Chesed to Netzach</strong><br/>Symbolizes a palm or a spoon, denoting potential and realization. It connects expansive love (Chesed) to eternal victory (Netzach), showing how divine generosity empowers persistence and success in the world.`,
        '×œ': `<strong>Lamed (×œ): Path Hod to Yesod</strong><br/>Symbolizes an ox goad or teaching, signifying learning and aspiration. It connects splendor and humility (Hod) to the foundation (Yesod), representing the process of spiritual learning that grounds divine glory in reality.`,
        '×': `<strong>Mem (×): Path Netzach to Hod</strong><br/>Symbolizes water, representing fluidity, transformation, and hidden depths. This horizontal path signifies the dynamic interplay and balance between endurance (Netzach) and surrender/splendor (Hod), a continuous flow of giving and receiving.`,
        '× ': `<strong>Nun (× ): Path Netzach to Yesod</strong><br/>Symbolizes a fish, signifying continuous movement and hidden life. It links enduring victory (Netzach) to the foundation (Yesod), depicting the consistent, often unseen, flow of divine energy that supports manifestation.`,
        '×¡': `<strong>Samech (×¡): Path Tiferet to Hod</strong><br/>Symbolizes a prop or a circle, denoting support and infinite potential. It connects beauty and harmony (Tiferet) to splendor and humility (Hod), representing the divine sustenance that upholds spiritual glory and recognition of divine source.`,
        '×¢': `<strong>Ayin (×¢): Path Binah to Tiferet</strong><br/>Symbolizes an eye, signifying perception, insight, and action. It links understanding (Binah) to balanced beauty (Tiferet), representing the deep wisdom that discerns and guides the central manifestation of divine harmony.`,
        '×¤': `<strong>Peh (×¤): Path Gevurah to Hod</strong><br/>Symbolizes a mouth, signifying speech and expression. It connects strength and judgment (Gevurah) to splendor and humility (Hod), representing the verbal articulation of divine discipline and the respectful acceptance of authority.`,
        '×¦': `<strong>Tzadi (×¦): Path Gevurah to Tiferet</strong><br/>Symbolizes a fish-hook or righteousness. It connects strength and judgment (Gevurah) to beauty and harmony (Tiferet), showing the precise application of divine justice that leads to perfect balance.`,
        '×§': `<strong>Kuf (×§): Path Binah to Chesed</strong><br/>Symbolizes the back of the head or a monkey, denoting limitation and hidden aspects. This often challenging path connects understanding (Binah) to boundless love (Chesed), representing the process of overcoming limitations to embrace expansive compassion.`,
        '×¨': `<strong>Resh (×¨): Path Tiferet to Yesod</strong><br/>Symbolizes a head, signifying beginning, intelligence, and self-renewal. It connects the central balance (Tiferet) to the foundation (Yesod), indicating the conscious decision and renewal of purpose that lead to grounded existence.`,
        '×©': `<strong>Shin (×©): Path Binah to Chochmah</strong><br/>Symbolizes fire, signifying transformation and intense spiritual energy. This horizontal path represents the dynamic interplay and fusion between wisdom (Chochmah) and understanding (Binah), the blazing insight that sparks true comprehension.`,
        '×ª': `<strong>Taf (×ª): Path Yesod to Malkut</strong><br/>Symbolizes a mark or a cross, signifying truth, completion, and the seal of creation. It connects the spiritual foundation (Yesod) to manifest reality (Malkut), representing the final actualization of all divine emanations in the physical world.`
      };

      // YOUR ORIGINAL SEFIROT MAP FOR KEYWORD DIAGNOSIS
      const sefirotMap = [
        {
          name: "Keter",
          keywords: ["no will", "empty", "directionless", "disconnected from Hashem"],
          insight: `
            ğŸ‘‘ <strong>Keter imbalance</strong><br/>
            <strong>Animal Soul:</strong> Loss of purpose, apathy<br/>
            <strong>Godly Soul:</strong> Deep will and delight in divine unity<br/>
            âœ¨ Keter is the crown â€” the transcendent root of all Sefirot, containing both Ratzon (will) and Oneg (delight).<br/>
            ğŸ“– "With You is the source of life; in Your light, we see light." (Psalms 36:10)<br/>
            <strong>Angels:</strong> Aralim (Thrones)<br/>
            <strong>Aleph Bet:</strong> Aleph (×) â€” Oneness, divine source<br/>
            <strong>Planet:</strong> Divine beyond â€” not bound to planetary influence.
          `
        },
        {
          name: "Chochmah",
          keywords: ["confused", "no insight", "mental block", "frozen"],
          insight: `
            ğŸ’¡ <strong>Chochmah imbalance</strong><br/>
            <strong>Animal Soul:</strong> Rashness, lack of clarity, confusion<br/>
            <strong>Godly Soul:</strong> Flash of divine insight, intuitive knowing<br/>
            ğŸŒŸ Chochmah is the first spark of wisdom, the seed of all intellect and consciousness.<br/>
            ğŸ“– "God founded the earth with wisdom." (Proverbs 3:19)<br/>
            <strong>Angels:</strong> Ophanim (Wheels)<br/>
            <strong>Aleph Bet:</strong> Bet (×‘) â€” duality, creation<br/>
            <strong>Planet:</strong> Uranus (in mystical interpretation) â€” sudden revelation.
          `
        },
        {
          name: "Binah",
          keywords: ["overthinking", "mental loops", "no understanding", "too much logic"],
          insight: `
            ğŸ§  <strong>Binah imbalance</strong><br/>
            <strong>Animal Soul:</strong> Over-analysis, anxiety, rigidity<br/>
            <strong>Godly Soul:</strong> Discernment, deep understanding, teshuvah<br/>
            ğŸ•Šï¸ Binah is the womb of intellect â€” it develops the flash of Chochmah into full understanding.<br/>
            ğŸ“– "With understanding, He established the heavens." (Proverbs 3:19)<br/>
            <strong>Angels:</strong> Erelim (Valiant Ones)<br/>
            <strong>Aleph Bet:</strong> Gimel (×’) â€” nurturing, giving<br/>
            <strong>Planet:</strong> Saturn â€” boundaries, form, contemplation.
          `
        },
        {
          name: "Netzach",
          keywords: ["quitting", "defeated", "can't keep going", "burned out"],
          insight: `
            ğŸ›¡ï¸ <strong>Netzach imbalance</strong><br/>
            <strong>Animal Soul:</strong> Burnout, ego drive, domination<br/>
            <strong>Godly Soul:</strong> Endurance, holy ambition, victory through faith<br/>
            ğŸ¥‡ Netzach is the divine attribute of victory and perseverance â€” the long road with courage.<br/>
            ğŸ“– "His mercy endures forever." (Psalms 136, repeated refrain)<br/>
            <strong>Angels:</strong> Elohim Tzevaot<br/>
            <strong>Aleph Bet:</strong> Nun (× ) â€” falling and rising<br/>
            <strong>Planet:</strong> Venus â€” endurance of love and beauty.
          `
        },
        {
          name: "Hod",
          keywords: ["shame", "self-hate", "doubt", "can't receive", "collapsed"],
          insight: `
            ğŸŒˆ <strong>Hod imbalance</strong><br/>
            <strong>Animal Soul:</strong> Shame, denial, resentment<br/>
            <strong>Godly Soul:</strong> Gratitude, humility, surrender<br/>
            ğŸ“¿ Hod is the majesty of submission and sincerity â€” the echo that follows Netzach's shout.<br/>
            ğŸ“– "Give thanks to Hashem for He is good." (Psalms 118:1)<br/>
            <strong>Angels:</strong> Benei Elohim (Sons of God)<br/>
            <strong>Aleph Bet:</strong> Samekh (×¡) â€” support, trust<br/>
            <strong>Planet:</strong> Mercury â€” communication, sincerity.
          `
        },
        {
          name: "Genesis 3:22",
          keywords: ["tree of life", "live forever", "genesis 3:22"],
          insight: `
            ğŸ“– <strong>Genesis 3:22</strong><br/>
            "And the Lord God said, 'Behold, the man is become as one of us, to know good and evil; and now, lest he put forth his hand, and take also of the tree of life, and eat, and live forever..."<br/><br/>
            ğŸŒ³ <strong>Sefirah Connection:</strong> <strong>Yesod</strong> (Foundation) and <strong>Malchut</strong> (Kingdom/Shechinah)<br/>
            In Jewish mystical tradition, the <strong>Tree of Life</strong> is the structure of the Sefirot, especially the central column (Keter â†’ Tiferet â†’ Yesod â†’ Malchut).<br/><br/>
            - <strong>Yesod</strong> channels divine energy from above into the world below â€” it is the <em>tzadik</em>, the foundation of the world.<br/>
            - <strong>Malchut</strong> is the vessel and final receiver of all divine influence â€” the realm of manifestation and presence.<br/><br/>
            ğŸƒ <strong>Insight:</strong> After the sin, access to eternal life (the pure, direct flow from Yesod to Malchut) was cut off. The unity was fractured.<br/><br/>
            â—God's action in this verse reflects the spiritual reality: humanity, in an unrectified state, could not receive eternal divine flow without fixing the breach in the Sefirotic pipeline.<br/><br/>
            ğŸ•¯ï¸ <strong>Healing:</strong> Restoration of this flow comes through rectifying Yesod (foundation, purity) and elevating Malchut (faithful presence) to once again receive from the Tree of Life.
          `
        }
      ];

      // DIAGNOSTIC FUNCTION - USES YOUR SEFIROT MAP AND ALEPH-BET
      function diagnoseSefirah(userInput) {
        const input = userInput.toLowerCase();
        
        // First check for Hebrew letters (Aleph-Bet)
        const hebrewLetterNames = {
          'aleph': '×', 'alef': '×',
          'bet': '×‘', 'beit': '×‘', 'vet': '×‘',
          'gimmel': '×’', 'gimel': '×’',
          'dalet': '×“', 'daled': '×“',
          'heh': '×”', 'hey': '×”', 'he': '×”',
          'vav': '×•', 'vov': '×•', 'waw': '×•',
          'zayin': '×–',
          'chet': '×—', 'het': '×—', 'khet': '×—',
          'tet': '×˜',
          'yud': '×™', 'yod': '×™',
          'kaf': '×›', 'chaf': '×›',
          'lamed': '×œ',
          'mem': '×',
          'nun': '× ',
          'samech': '×¡', 'samekh': '×¡',
          'ayin': '×¢', 'ayn': '×¢',
          'peh': '×¤', 'pey': '×¤', 'feh': '×¤',
          'tzadi': '×¦', 'tsadi': '×¦', 'tzadik': '×¦',
          'kuf': '×§', 'quf': '×§', 'kof': '×§',
          'resh': '×¨', 'reish': '×¨',
          'shin': '×©',
          'taf': '×ª', 'tav': '×ª'
        };
        
        // Check if user is asking about a Hebrew letter
        for (let [name, letter] of Object.entries(hebrewLetterNames)) {
          if (input.includes(name) || input.includes(letter)) {
            if (contentMapAlephBet[letter]) {
              return contentMapAlephBet[letter];
            }
          }
        }
        
        // Then check for Sefirot keywords
        for (let sefirah of sefirotMap) {
          if (sefirah.keywords.some(kw => input.includes(kw))) {
            return sefirah.insight;
          }
        }
        // If no keyword match, return a specific string to signal fallback
        return "NO_DIAGNOSIS_MATCH";
      }

      // Function to handle chatbot responses using LLM - Primary: Gemini, Backup: ChatGPT
      async function getBotResponse(userMessage) {
        chatbotLoading.classList.remove("hidden"); // Show loading indicator
        
        // Try Gemini first
        const geminiResponse = await tryGeminiAPI(userMessage);
        if (geminiResponse !== null) {
          chatbotLoading.classList.add("hidden");
          return geminiResponse;
        }
        
        // If Gemini fails, fallback to ChatGPT
        console.log("Gemini failed, falling back to ChatGPT...");
        const chatGPTResponse = await tryChatGPTAPI(userMessage);
        chatbotLoading.classList.add("hidden");
        return chatGPTResponse;
      }

      // Primary API: Google Gemini via Netlify Function
      async function tryGeminiAPI(userMessage) {
        try {
          const response = await fetch('/.netlify/functions/gemini', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ input: userMessage })
          });

          if (!response.ok) {
            console.error("Gemini API Error:", response.status, response.statusText);
            return null; // Signal failure to try backup
          }

          const result = await response.json();
          if (result.candidates && result.candidates.length > 0 &&
              result.candidates[0].content && result.candidates[0].content.parts &&
              result.candidates[0].content.parts.length > 0) {
            return result.candidates[0].content.parts[0].text;
          } else {
            console.error("Unexpected Gemini response structure:", result);
            return null;
          }
        } catch (error) {
          console.error("Error calling Gemini API:", error);
          return null; // Signal failure to try backup
        }
      }

      // Backup API: OpenAI ChatGPT via Netlify Function
      async function tryChatGPTAPI(userMessage) {
        try {
          const response = await fetch('/.netlify/functions/chatgpt', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ input: userMessage })
          });

          if (!response.ok) {
            console.error("ChatGPT API Error:", response.status, response.statusText);
            return `I'm having trouble connecting to my wisdom sources right now. Please try again in a moment. ğŸŒ¿`;
          }

          const result = await response.json();
          if (result.message) {
            return result.message;
          } else {
            console.error("Unexpected ChatGPT response structure:", result);
            return "My apologies, I couldn't generate a response at this moment. Please try again.";
          }
        } catch (error) {
          console.error("Error calling ChatGPT API:", error);
          return "I'm having trouble connecting right now. Please check your internet connection or try again later.";
        }
      }

      // Event listener for chat input - now handles both diagnostic and LLM responses
      if (chatInput && chatContent) {
        chatInput.addEventListener("keydown", async (event) => {
          if (event.key === "Enter") {
            const msg = chatInput.value.trim();
            if (!msg) return;

            const userMsg = document.createElement("div");
            userMsg.textContent = "ğŸ—£ï¸ You: " + msg;
            chatContent.appendChild(userMsg);
            chatInput.value = ''; // Clear input immediately

            const botPlaceholder = document.createElement("div");
            botPlaceholder.classList.add("mt-1"); // Start with no italic/gray for easier replacement
            botPlaceholder.innerHTML = " Mystic Guide is thinking..."; // Will be replaced

            chatContent.appendChild(botPlaceholder);
            chatContent.scrollTop = chatContent.scrollHeight; // Scroll to bottom

            // Attempt rule-based diagnosis first
            let botResponseText = diagnoseSefirah(msg);

            if (botResponseText === "NO_DIAGNOSIS_MATCH") {
              // If no diagnosis, use LLM
              botPlaceholder.innerHTML = `<span class="text-gray-500 italic"> Mystic Guide is thinking...</span>`; // Show thinking state for LLM
              botResponseText = await getBotResponse(msg);
            } else {
                // If a diagnosis was made, remove thinking message or ensure it wasn't added for this path
                chatbotLoading.classList.add("hidden"); // Ensure loading is hidden for instant responses
            }

            // Update the bot's reply
            botPlaceholder.innerHTML = `ğŸŒ¿ Mystic Guide: ${botResponseText}`;
            botPlaceholder.classList.remove("text-gray-500", "italic"); // Remove thinking style
            chatContent.scrollTop = chatContent.scrollHeight; // Scroll to bottom again
          }
        });
      }

      // Toggle chat popup
      const guideLeaf = document.getElementById('guideLeaf');
      const chatPopup = document.getElementById('chat-popup');
      if (guideLeaf && chatPopup) {
        guideLeaf.addEventListener('click', () => {
          chatPopup.classList.toggle('hidden');
        });
      }

      // Sefirah click handlers
      document.querySelectorAll('.sefira').forEach(element => {
        const name = element.getAttribute("data-name");
        element.innerHTML = `<span class='text-white font-bold text-sm'>${name}</span>`;
        element.addEventListener('click', () => {
          if (currentOpen === `sefira-${name}`) { // Differentiate between Sefirah and Aleph-Bet
            popupBox.classList.add("hidden");
            currentOpen = null;
          } else {
            popupText.innerHTML = contentMapSefirah[name] || `${name} info coming soon.`;
            popupBox.classList.remove("hidden");
            currentOpen = `sefira-${name}`;
          }
        });
      });

      // Aleph-Bet click handlers
      document.querySelectorAll('.aleph-bet').forEach(element => {
        const letter = element.getAttribute("data-letter");
        element.addEventListener('click', () => {
          if (currentOpen === `letter-${letter}`) { // Differentiate between Sefirah and Aleph-Bet
            popupBox.classList.add("hidden");
            currentOpen = null;
          } else {
            popupText.innerHTML = contentMapAlephBet[letter] || `${letter} info coming soon.`;
            popupBox.classList.remove("hidden");
            currentOpen = `letter-${letter}`;
          }
        });
      });
    });
    // END OF CHATBOT AND INTERACTIVITY JAVASCRIPT CODE
  </script>
</head>
<body class="bg-cover bg-no-repeat bg-center font-serif" style="background-image: url('tree-of-life.webp');">
  <div class="background-stars"></div> <div class="dragonfly dragonfly-1"></div>
<div class="dragonfly dragonfly-2"></div>
<div class="dragonfly dragonfly-3"></div>

  <div id="app" class="relative flex flex-col items-center justify-center min-h-screen p-4">
    <div class="sefira absolute" style="top: 6%; left: 50%; transform: translate(-50%, -50%);" data-name="Keter"></div>
    <div class="sefira absolute" style="top: 12%; left: 70%; transform: translate(-50%, -50%);" data-name="Chochmah"></div>
    <div class="sefira absolute" style="top: 12%; left: 30%; transform: translate(-50%, -50%);" data-name="Binah"></div>
    <div class="sefira absolute" style="top: 28%; left: 65%; transform: translate(-50%, -50%);" data-name="Chesed"></div>
    <div class="sefira absolute" style="top: 28%; left: 35%; transform: translate(-50%, -50%);" data-name="Gevurah"></div>
<div class="sefira absolute" style="top: 36%; left: 50%; transform: translate(-50%, -50%);" data-name="Tiferet"></div>

    <div class="sefira absolute" style="top: 54%; left: 60%; transform: translate(-50%, -50%);" data-name="Netzach"></div>
    <div class="sefira absolute" style="top: 54%; left: 40%; transform: translate(-50%, -50%);" data-name="Hod"></div>
    <div class="sefira absolute" style="top: 70%; left: 50%; transform: translate(-50%, -50%);" data-name="Yesod"></div>
    <div class="sefira absolute" style="top: 85%; left: 50%; transform: translate(-50%, -50%);" data-name="Malchut"></div>

    <div class="aleph-bet absolute z-50" data-letter="×" style="top:28%; left:50%;">×</div> <div class="aleph-bet absolute z-50" data-letter="×‘" style="top:20%; left:67.5%;">×‘</div> <div class="aleph-bet absolute z-50" data-letter="×’" style="top:20%; left:32.5%;">×’</div> <div class="aleph-bet absolute z-50" data-letter="×“" style="top:21%; left:50%;">×“</div> <div class="aleph-bet absolute z-50" data-letter="×”" style="top:7%; left:60%;">×”</div> <div class="aleph-bet absolute z-50" data-letter="×•" style="top:7%; left:40%;">×•</div> <div class="aleph-bet absolute z-50" data-letter="×–" style="top:20%; left:52.5%;">×–</div> <div class="aleph-bet absolute z-50" data-letter="×—" style="top:34%; left:57.5%;">×—</div> <div class="aleph-bet absolute z-50" data-letter="×˜" style="top:26%; left:60%;">×˜</div> <div class="aleph-bet absolute z-50" data-letter="×™" style="top:47%; left:55%;">×™</div> <div class="aleph-bet absolute z-50" data-letter="×›" style="top:41%; left:62.5%;">×›</div> <div class="aleph-bet absolute z-50" data-letter="×œ" style="top:62%; left:45%;">×œ</div> <div class="aleph-bet absolute z-50" data-letter="×" style="top:54%; left:50%;">×</div> <div class="aleph-bet absolute z-50" data-letter="× " style="top:62%; left:55%;">× </div> <div class="aleph-bet absolute z-50" data-letter="×¡" style="top:47%; left:45%;">×¡</div> <div class="aleph-bet absolute z-50" data-letter="×¢" style="top:26%; left:40%;">×¢</div> <div class="aleph-bet absolute z-50" data-letter="×¤" style="top:41%; left:37.5%;">×¤</div> <div class="aleph-bet absolute z-50" data-letter="×¦" style="top:34%; left:42.5%;">×¦</div> <div class="aleph-bet absolute z-50" data-letter="×§" style="top:20%; left:47.5%;">×§</div> <div class="aleph-bet absolute z-50" data-letter="×¨" style="top:58%; left:50%;">×¨</div> <div class="aleph-bet absolute z-50" data-letter="×©" style="top:12%; left:50%;">×©</div> <div class="aleph-bet absolute z-50" data-letter="×ª" style="top:77.5%; left:50%;">×ª</div> </div> <div id="popupBox" class="hidden absolute bottom-10 p-4 bg-white border border-yellow-500 rounded shadow-md z-40 max-w-md">
    <p id="popupText" class="text-sm text-gray-800"></p>
  </div>

  <div id="chat-popup" class="hidden absolute bottom-24 right-10 bg-white border-2 border-yellow-400 shadow-lg p-4 rounded-xl w-80 max-w-full z-50">
    <div class="font-bold text-purple-700 mb-2">ğŸŒ¿ Mystic Guide</div>
    <div id="chat-content" class="text-sm text-gray-800 h-40 overflow-y-auto mb-2">
      Shalom, I am your MysticMinded Guide ğŸŒ¿<br/>
      What Sefirah are you drawn to?<br/>
      Or tell me what you're struggling with, and Iâ€™ll help identify your soulâ€™s imbalances.
    </div>
    <input id="chat-input" type="text" placeholder="Type your question or struggle..." class="w-full border border-gray-300 rounded px-2 py-1" />
    <div id="chatbot-loading" class="hidden text-center text-gray-600 mt-2">
      Mystic Guide is thinking<span class="loading-dots"></span>
    </div>
  </div>
<img src="mystic-leaf.png" id="guideLeaf" alt="MysticMinded Guide" class="w-28 h-28 rounded-full object-cover cursor-pointer absolute top-[48%] left-1/2 transform -translate-x-1/2 z-50 hover:scale-110 transition"/>
 

  <div id="guidanceArrow" style="position: absolute; top: 46%; left: calc(50% + 50px); transform: translateY(-50%); z-index: 51; display: flex; align-items: center; white-space: nowrap;">
  <div style="font-size: 1rem; color: #e7ca12; white-space: nowrap; margin-right: 5px;">Click here for guidance</div>
</div>
