<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"/>
  <title>Golden Tree of Sefirot</title>
  <link rel="stylesheet" href="style.css" />
  <script defer>
    // START OF CHATBOT AND INTERACTIVITY JAVASCRIPT CODE - HYBRID SYSTEM
    document.addEventListener("DOMContentLoaded", () => {
      const chatInput = document.getElementById("chat-input");
      const chatContent = document.getElementById("chat-content");
      const popupBox = document.getElementById("popupBox");
      const popupText = document.getElementById("popupText");
      const chatbotLoading = document.getElementById("chatbot-loading");
      let currentOpen = null;

      // Full Sefirah content - "Associated Aleph Bet" updated to reflect YOUR path mapping
      const contentMapSefirah = {
        Keter: `<strong>Keter (Crown)</strong><br/>The highest Sefirah, representing divine will, pure consciousness, and infinite light. It is the primordial point beyond human comprehension, the source of all emanation.<br/><br/><strong>Associated Angels:</strong> Chayot HaKodesh (Holy Living Creatures), Seraphim.<br/><strong>Associated Aleph Bet:</strong> Dalet (×“), Heh (×”), or Vav (×•) â€“ letters connecting Keter to other Sefirot, showing divine emanation.<br/><strong>Associated Constellations:</strong> Beyond specific constellations, as Keter transcends the manifest universe.`,
        Chochmah: `<strong>Chochmah (Wisdom)</strong><br/>The first flash of an idea, pure undifferentiated wisdom, the point of emanation from Keter. It is the initial spark of creation, often associated with the 'Father' principle.<br/><br/><strong>Associated Angels:</strong> Ophanim (Wheels), also known as the Erelim.<br/><strong>Associated Aleph Bet:</strong> Shin (×©), Bet (×‘), Zayin (×–), or Tet (×˜) â€“ letters on paths connected to Chochmah, revealing aspects of its wisdom.<br/><strong>Associated Constellations:</strong> Mazalot (general term for constellations), as Chochmah is the source of astrological influence and cosmic order.`,
        Binah: `<strong>Binah (Understanding)</strong><br/>The expansion of Chochmah into detailed understanding, giving form and structure to the initial idea. It represents divine motherly nurturing, discernment, and the 'Mother' principle. It is one of the 'Three Mothers' along with Keter and Chochmah, forming the intellectual triad.<br/><br/><strong>Associated Angels:</strong> Aralim (Thrones), also known as the Cherubim.<br/><strong>Associated Aleph Bet:</strong> Gimel (×’), Vav (×•), Ayin (×¢), Kuf (×§), or Shin (×©) â€“ letters on paths connected to Binah, emphasizing its form-giving and understanding aspects.<br/><br/><strong>Associated Constellations:</strong> Tehom (Deep, Abyss), related to primordial waters and the vastness of understanding.`,
        Chesed: `<strong>Chesed (Loving-kindness)</strong><br/>Expansive love, boundless grace, mercy, and benevolence. It is the outpouring of divine goodness, extending without limit, often associated with the 'Greatness' of God.<br/><br/><strong>Associated Angels:</strong> Chashmalim (Brilliant Ones/Amber), also known as Dominions.<br/><strong>Associated Aleph Bet:</strong> Aleph (×), Bet (×‘), Chet (×—), or Kaf (×›) â€“ letters on paths connected to Chesed, reflecting its expansive and loving qualities.<br/><br/><strong>Associated Constellations:</strong> Jupiter, representing expansion, abundance, and beneficence.`,
        Gevurah: `<strong>Gevurah (Strength/Justice)</strong><br/>Restraint, discipline, judgment, and severity. It limits Chesed, providing structure for balance and justice in creation. Often associated with the 'Might' of God.<br/><br/><strong>Associated Angels:</strong> Seraphim (Fiery Ones), also known as Powers.<br/><br/><strong>Associated Aleph Bet:</strong> Aleph (×), Gimel (×’), Zayin (×–), Peh (×¤), or Tzadi (×¦) â€“ letters on paths connected to Gevurah, highlighting its power and discernment.<br/><br/><strong>Associated Constellations:</strong> Mars, representing strength, discipline, and sometimes conflict.`,
        Tiferet: `<strong>Tiferet (Beauty)</strong><br/>Harmony, compassion, truth, and balance. It is the central Sefirah, reconciling Chesed and Gevurah, and is often associated with the 'Son' or 'King' principle. It represents the beauty of God's perfect balance.<br/><br/><strong>Associated Angels:</strong> Shinanim (Burning Flames), also known as Virtues.<br/><br/><strong>Associated Aleph Bet:</strong> Dalet (×“), Chet (×—), Tet (×˜), Yud (×™), Samech (×¡), Ayin (×¢), Tzadi (×¦), or Resh (×¨) â€“ letters on paths connected to Tiferet, emphasizing its central balancing role.<br/><br/><strong>Associated Constellations:</strong> Sun, representing illumination, centrality, and life-giving energy.`,
        Netzach: `<strong>Netzach (Eternity/Victory)</strong><br/>Endurance, perseverance, victory, and divine triumph. It represents the drive to overcome obstacles and achieve goals, the 'Eternity' of God.<br/><br/><strong>Associated Angels:</strong> Tarshishim (Sparkling Ones), also known as Principalities.<br/><br/><strong>Associated Aleph Bet:</strong> Yud (×™), Kaf (×›), Mem (×), or Nun (× ) â€“ letters on paths connected to Netzach, reflecting its enduring and conquering nature.<br/><br/><strong>Associated Constellations:</strong> Venus, representing victory, love, and enduring beauty.`,
        Hod: `<strong>Hod (Splendor/Glory)</strong><br/>Humility, surrender, resonance, and divine glory. It is the receptive counterpart to Netzach, acknowledging the source of power, the 'Glory' of God.<br/><br/><strong>Associated Angels:</strong> Beni Elohim, also known as Archangels.<br/><br/><strong>Associated Aleph Bet:</strong> Lamed (×œ), Mem (×), Peh (×¤), or Ayin (×¢) â€“ letters on paths connected to Hod, signifying its reflective and receptive qualities.<br/><br/><strong>Associated Constellations:</strong> Mercury, representing communication, intellect, and splendor.`,
        Yesod: `<strong>Yesod (Foundation)</strong><br/>Connection, foundation, bonding, and the transmission of divine energy to Malkuth. It is the channel through which all preceding Sefirot flow into manifestation, the 'Foundation' of all existence.<br/><br/><strong>Associated Angels:</strong> Cherubim (Strong Ones/Guardians), also known as Angels.<br/><br/><strong>Associated Aleph Bet:</strong> Lamed (×œ), Nun (× ), Resh (×¨), or Taf (×ª) â€“ letters on paths connected to Yesod, representing its foundational and connective role.<br/><br/><strong>Associated Constellations:</strong> Moon, representing foundation, cycles, and the receptacle of light.`,
        Malchut: `<strong>Malkuth (Kingdom/Presence)</strong><br/>The physical world, manifest reality, and the divine feminine presence (Shekhinah). It is the culmination of all divine emanations, where divinity is experienced in creation, the 'Kingdom' of God. It is also considered one of the 'Crossroads' in the Tree of Life, representing the horizontal links that balance energies.<br/><br/><strong>Associated Angels:</strong> Ishim (Souls of Fire/Men of God), also known as Aishim.<br/><br/><strong>Associated Aleph Bet:</strong> Taf (×ª) â€“ the letter on the path connecting Yesod to Malkuth, symbolizing truth and completion in manifestation.<br/><br/><strong>Associated Constellations:</strong> Earth, representing the physical realm, manifestation, and the culmination of all energies.`
      };

      // Content for Aleph-Bet letters on the paths based on YOUR custom mapping - Enhanced with Bahir teachings
      const contentMapAlephBet = {
        '×': `<strong>Aleph (×): Path Gevurah to Chesed</strong><br/>
          <strong>Shape & Meaning:</strong> Aleph is composed of two Yuds (one above, one below) connected by a diagonal Vav, representing the unity of upper and lower worlds.<br/>
          <strong>Gematria:</strong> 1 - Unity, Oneness of God<br/>
          <strong>Path:</strong> Connects restriction (Gevurah) and expansion (Chesed), balancing judgment with mercy.<br/><br/>
          ğŸ“– <strong>From Sefer Yetzirah:</strong> "He made the letter Alef reign over Wind/Breath, and He bound to it a crown. He combined them one with another. With them He sealed the Wind in the World, satiation in the Year, and the chest in the Personâ€”the breath of life itself."<br/>
          <a href="https://www.sefaria.org/Sefer_Yetzirah.3.6" target="_blank" style="color: #FFD700;">ğŸ“š Sefer Yetzirah 3:6</a><br/><br/>
          ğŸŒ¬ï¸ Aleph is silent yet carries all soundâ€”the ineffable Name begins with this letter, teaching us that divine unity underlies all apparent duality.`,
        
        '×‘': `<strong>Bet (×‘): Path Chochmah to Chesed</strong><br/>
          <strong>Shape & Meaning:</strong> Bet (×‘) is shaped like a house with three wallsâ€”open on the left side, facing forward into creation. It is closed on three sides (above, behind, below) but open toward the future, teaching us to look forward, not back to what was before creation.<br/>
          <strong>Gematria:</strong> 2 - Duality, blessing (×‘Ö°Ö¼×¨Ö¸×›Ö¸×”), house (×‘Ö·Ö¼×™Ö´×ª)<br/>
          <strong>Path:</strong> Carries Wisdom (Chochmah) into manifestation as Loving-kindness (Chesed)â€”the 'house' that contains divine generosity.<br/><br/>
          ğŸ“– <strong>From Sefer HaBahir:</strong> "Why does the Torah begin with the letter Bet (×‘Ö°Ö¼×¨Öµ××©Ö´××™×ª)? In order that it begin with a <em>blessing</em> (×‘Ö°Ö¼×¨Ö¸×›Ö¸×”â€”bracha). For the word 'beginning' (×¨Öµ××©Ö´××™×ªâ€”reishit) is nothing other than <strong>Wisdom</strong> (Chochmah). And Wisdom is a blessing."<br/>
          <a href="https://www.sefaria.org/Sefer_HaBahir.3" target="_blank" style="color: #FFD700;">ğŸ“š Sefer HaBahir 3</a><br/><br/>
          ğŸ  <strong>The Shape Teaches:</strong> Bet is closed above (we cannot know what is above the heavens), closed behind (we cannot know what was before creation), closed below (we cannot know what is beneath the earth)â€”but open to the front, toward all that will unfold from the moment of <em>"Bereishit"</em>â€”In the Beginning.<br/><br/>
          ğŸ’« The Torah begins with Bet to proclaim: <strong>Creation itself is a blessing!</strong> Every act of bringing wisdom into loving manifestation builds a dwelling place for the Divine Presence.`,
        
        '×’': `<strong>Gimmel (×’): Path Binah to Gevurah</strong><br/>
          <strong>Shape & Meaning:</strong> Gimmel looks like a person runningâ€”a foot extended forward in motion. It pursues the Dalet (×“, the poor one) to give charity.<br/>
          <strong>Gematria:</strong> 3 - Bestowing, running to give (×’Ö¹Ö¼×Ö¶×œ ×—Ö¶×¡Ö¶×“â€”gomel chesed)<br/>
          <strong>Path:</strong> Brings Understanding (Binah) into disciplined Strength (Gevurah)â€”discernment applied with precision.<br/><br/>
          ğŸ“– <strong>From Sefer HaBahir:</strong> "Why is Gimmel third? Because it has three parts. It teaches us that it <em>bestows</em> (×’Ö¼×•Ö¹×Ö¶×œÖ¶×ªâ€”gomelet) kindness. What does it bestow? It bestows, it grows, and it sustains all that exists."<br/>
          <a href="https://www.sefaria.org/Sefer_HaBahir.19" target="_blank" style="color: #FFD700;">ğŸ“š Sefer HaBahir 19</a><br/><br/>
          ğŸƒ Gimmel-Dalet (×’×“): The Gimmel runs toward the Dalet (the poor), symbolizing <em>gemilut chasadim</em>â€”acts of loving-kindness. Charity must be given with <em>running feet</em>, with urgency and joy!`,
        '×“': `<strong>Dalet (×“): Path Keter to Tiferet</strong><br/>
          <strong>Shape & Meaning:</strong> Dalet is a bent figureâ€”a person bowing in humility, or one who is poor (×“Ö·Ö¼×œâ€”dal).<br/>
          <strong>Gematria:</strong> 4 - Doorway (×“Ö¶Ö¼×œÖ¶×ªâ€”delet), poverty, humility<br/>
          <strong>Path:</strong> Direct descent from Divine Will (Keter) to Harmony (Tiferet)â€”the door through which blessing flows.<br/><br/>
          ğŸ“– <strong>The Gimmel-Dalet Pair:</strong> "The Gimmel has a foot stretched out running toward the Dalet, because it is the way of the benevolent (gomel chasadim) to run after the poor (dal). The Dalet faces away because one must give to the poor with dignityâ€”allowing them to receive without shame."<br/>
          <a href="https://www.sefaria.org/Shabbat.104a" target="_blank" style="color: #FFD700;">ğŸ“š Talmud Shabbat 104a</a><br/><br/>
          ğŸšª Dalet is the <em>door</em>â€”when we bow in humility (Keter's nothingness), divine beauty (Tiferet) flows through us into the world.`,
        
        '×”': `<strong>Heh (×”): Path Keter to Chochmah</strong><br/>
          <strong>Shape & Meaning:</strong> Heh is like a windowâ€”open on the left side, allowing air and light to enter. It appears twice in God's Name (×™×”×•×”).<br/>
          <strong>Gematria:</strong> 5 - The five levels of soul, the five books of Torah, breath (×”Ö¶×‘Ö¶×œâ€”hevel)<br/>
          <strong>Path:</strong> The breath of revelation from Infinite Crown (Keter) into the flash of Wisdom (Chochmah).<br/><br/>
          ğŸ“– <strong>From Genesis:</strong> "And God <em>breathed</em> (×•Ö·×™Ö´Ö¼×¤Ö·Ö¼×—) into his nostrils the <em>breath of life</em> (× Ö´×©Ö°××Ö·×ª ×—Ö·×™Ö´Ö¼×™×)â€”and man became a living soul." The letter Heh is that divine breath!<br/>
          <a href="https://www.sefaria.org/Genesis.2.7" target="_blank" style="color: #FFD700;">ğŸ“š Genesis 2:7</a><br/><br/>
          ğŸŒ¬ï¸ <strong>The Divine Name:</strong> The Heh appears twice in YHVH (×™×”×•×”)â€”first after Yud (representing Chochmah/Wisdom, the Father principle), then after Vav (representing Tiferet, the Son). These two Hehs are Binah (Understanding, Mother) and Malchut (Kingdom, Daughter)â€”divine feminine breath giving form to creation.`,
        
        '×•': `<strong>Vav (×•): Path Keter to Binah</strong><br/>
          <strong>Shape & Meaning:</strong> Vav is a straight vertical lineâ€”a hook, a nail, a connector. The letter of "and" (×•Ö°).<br/>
          <strong>Gematria:</strong> 6 - The six directions of space, the six days of creation, connection<br/>
          <strong>Path:</strong> The nail that fastens Divine Will (Keter) to Understanding (Binah)â€”stabilizing the central pillar.<br/><br/>
          ğŸ“– <strong>Six Days of Creation:</strong> Each day begins with "Vav" (×•Ö·×™Ö°×”Ö´×™â€”"And there was..."). The Vav <em>connects</em> each day to the one before, showing continuous divine creative flow.<br/>
          <a href="https://www.sefaria.org/Genesis.1" target="_blank" style="color: #FFD700;">ğŸ“š Genesis 1</a><br/><br/>
          ğŸ”— Vav is the <em>pillar of connection</em>â€”it joins heaven and earth, past and future, thought and form. In the Divine Name (×™×”×•×”), Vav represents Tiferet, the Son principle that unites all Sefirot.`,
        
        '×–': `<strong>Zayin (×–): Path Chochmah to Gevurah</strong><br/>
          <strong>Shape & Meaning:</strong> Zayin looks like a sword or crowned weaponâ€”a Vav (×•) with a crown on top.<br/>
          <strong>Gematria:</strong> 7 - Shabbat (7th day), sustenance (×–Ö¸×Ÿâ€”zan, to nourish), weapon (×–Ö·×™Ö´×Ÿâ€”zayin)<br/>
          <strong>Path:</strong> Cuts Wisdom (Chochmah) into precise Strength (Gevurah)â€”discernment as divine sword.<br/><br/>
          ğŸ“– <strong>From the Bahir:</strong> "Zayinâ€”because it <em>nourishes</em> (×–Ö¸×Ÿ) all that exists. Just as a king provides for his subjects, so does this letter represent divine sustenance flowing through boundaries."<br/>
          <a href="https://www.sefaria.org/Sefer_HaBahir" target="_blank" style="color: #FFD700;">ğŸ“š Sefer HaBahir</a><br/><br/>
          âš”ï¸ The sword of Zayin is also the staff of Shabbatâ€”the seventh day when we cease creating and receive divine nourishment. It teaches: true strength comes from knowing when to <em>stop</em> and receive.`,

        '×—': `<strong>Chet (×—): Path Chesed to Tiferet</strong><br/>
          <strong>Shape & Meaning:</strong> Chet is formed by two vertical lines (Zayins) connected by a bridge on topâ€”like a gateway or courtyard.<br/>
          <strong>Gematria:</strong> 8 - Life (×—Ö·×™â€”chai), transcendence beyond the natural seven, fear/awe (×—Öµ×˜Ö°× suggests breaking through barriers)<br/>
          <strong>Path:</strong> Sacred enclosure carrying Loving-kindness (Chesed) into Harmony (Tiferet)â€”the protective fence of love.<br/><br/>
          ğŸ“– <strong>From Sefer HaBahir:</strong> "Why is the letter Chet (×—) open? Because all directions (×¨×•Ö¼×—×•Ö¹×ªâ€”ruchot) are closed, except for the North, which is opened for good and for evil. From the North, harsh judgments can flow, but also great light when rectified."<br/>
          <a href="https://www.sefaria.org/Sefer_HaBahir.35" target="_blank" style="color: #FFD700;">ğŸ“š Sefer HaBahir 35</a><br/><br/>
          ğŸ›ï¸ Chet represents <em>×—Ö·×™</em>â€”LIFE itself! It is the fence that creates sacred space, protecting the holy from the profane. Through this path, Chesed's boundless love finds its true expression in Tiferet's balanced beauty.`,
        
        '×˜': `<strong>Tet (×˜): Path Chochmah to Tiferet</strong><br/>
          <strong>Shape & Meaning:</strong> Tet is curved inward, like a vessel that containsâ€”or like a snake coiled.<br/>
          <strong>Gematria:</strong> 9 - Hidden good (×˜×•Ö¹×‘â€”tov), pregnancy/gestation, the serpent (× Ö¸×—Ö¸×©×)<br/>
          <strong>Path:</strong> Hidden goodness flowing from Wisdom (Chochmah) into Beauty (Tiferet)â€”concealed divine providence.<br/><br/>
          ğŸ“– <strong>From the Bahir:</strong> "Tetâ€”because it contains <em>goodness</em> (×˜×•Ö¼×‘) that is hidden within. The first time Tet appears in Torah is in '×˜×•Ö¹×‘' (good)â€”'And God saw that the light was <em>good</em>.' This good was hidden away for the righteous in the World to Come."<br/>
          <a href="https://www.sefaria.org/Genesis.1.4" target="_blank" style="color: #FFD700;">ğŸ“š Genesis 1:4</a><br/><br/>
          ğŸ Tet is invertedâ€”its opening faces inward, teaching that true goodness is <em>concealed</em>. Not all wisdom is immediately visible; some must be discovered within, like a treasure hidden in the heart.`,
        
        '×™': `<strong>Yud (×™): Path Tiferet to Netzach</strong><br/>
          <strong>Shape & Meaning:</strong> Yud is the smallest letterâ€”just a point, a seed, a hand.<br/>
          <strong>Gematria:</strong> 10 - The ten Sefirot, completion, the hand (×™Ö¸×“â€”yad), emanation<br/>
          <strong>Path:</strong> The divine <em>hand</em> extending Beauty (Tiferet) into Victory (Netzach)â€”active manifestation.<br/><br/>
          ğŸ“– <strong>From Sefer Yetzirah:</strong> "<em>Ten</em> Sefirot Belimahâ€”ten and not nine, ten and not eleven. Understand with Wisdom, be wise with Understanding." The Yud represents the totality of divine emanation in potential form.<br/>
          <a href="https://www.sefaria.org/Sefer_Yetzirah.1.4" target="_blank" style="color: #FFD700;">ğŸ“š Sefer Yetzirah 1:4</a><br/><br/>
          âœ‹ <strong>The Divine Hand:</strong> Yud is the first letter of God's Name (×™×”×•×”). It is the <em>point</em> from which all creation emergesâ€”the seed containing the entire tree! Though smallest, it contains infinite potential.`,
        
        '×›': `<strong>Kaf (×›): Path Chesed to Netzach</strong><br/>
          <strong>Shape & Meaning:</strong> Kaf is curved like a palm or a crownâ€”open to receive or give.<br/>
          <strong>Gematria:</strong> 20 - Crown (×›Ö¶Ö¼×ªÖ¶×¨â€”keter), palm (×›Ö·Ö¼×£â€”kaf), to bend/subdue<br/>
          <strong>Path:</strong> The open palm of giving, flowing Loving-kindness (Chesed) into enduring Victory (Netzach).<br/><br/>
          ğŸ“– <strong>From Psalms:</strong> "You open Your hand (×›Ö¸Ö¼×¤Ö¶×šÖ¸) and satisfy every living thing with favor."â€”God's palm is always open to give!<br/>
          <a href="https://www.sefaria.org/Psalms.145.16" target="_blank" style="color: #FFD700;">ğŸ“š Psalms 145:16</a><br/><br/>
          ğŸ‘‘ Kaf has two forms: Kaf (×›) at the beginning/middle of a word is open and curved. Kaf Sofit (×š) at the end is straight and descendingâ€”teaching us that giving must sometimes be direct and decisive. True chesed empowers others toward their own victory.`,

        '×œ': `<strong>Lamed (×œ): Path Hod to Yesod</strong><br/>
          <strong>Shape & Meaning:</strong> Lamed towers above all other lettersâ€”it ascends like a tower reaching toward heaven.<br/>
          <strong>Gematria:</strong> 30 - Learning/teaching (×œÖ´×Ö¼×•Ö¼×“â€”limud), heart (×œÖµ×‘â€”lev), aspiration<br/>
          <strong>Path:</strong> The aspiring heart connecting Humility (Hod) to Foundation (Yesod)â€”learning grounds glory.<br/><br/>
          ğŸ“– <strong>From the Talmud:</strong> "Lamed stands for <em>Lev</em> (×œÖµ×‘â€”heart) and <em>Lomed</em> (×œ×•Ö¹×Öµ×“â€”one who learns). It is the tower reaching toward the King (Keter). A heart that truly learns reaches upward!"<br/>
          <a href="https://www.sefaria.org/Shabbat.104a" target="_blank" style="color: #FFD700;">ğŸ“š Talmud Shabbat 104a</a><br/><br/>
          ğŸ“š Lamed is the <em>only</em> letter that rises above the baselineâ€”teaching that the heart of one who studies Torah soars beyond earthly limits. True learning (Hod's humility) creates the foundation (Yesod) for all spiritual growth.`,
        
        '×': `<strong>Mem (×): Path Netzach to Hod</strong><br/>
          <strong>Shape & Meaning:</strong> Mem is closed (×) or open (× at end of word)â€”like water contained or flowing.<br/>
          <strong>Gematria:</strong> 40 - Water (×Ö·×™Ö´×â€”mayim), womb, transformation, the 40 days/years of testing<br/>
          <strong>Path:</strong> The waters of transformation flowing between Victory (Netzach) and Glory (Hod)â€”dynamic balance.<br/><br/>
          ğŸ“– <strong>From Sefer Yetzirah:</strong> "He made the letter Mem reign over Water, and He bound to it a crown. He combined them one with another. With them He sealed the <em>earth</em> in the World, <em>cold</em> in the Year, and the <em>belly</em> in the Personâ€”the waters of the womb from which all life emerges."<br/>
          <a href="https://www.sefaria.org/Sefer_Yetzirah.3.7" target="_blank" style="color: #FFD700;">ğŸ“š Sefer Yetzirah 3:7</a><br/><br/>
          ğŸ’§ <strong>Open and Closed Mem:</strong> The closed Mem (×) is <em>hidden wisdom</em> (like the waters above). The open Mem Sofit (×) is <em>revealed wisdom</em> (like the waters below). Together they teach: wisdom must flow yet be containedâ€”giving and receiving in perfect balance.`,
        
        '× ': `<strong>Nun (× ): Path Netzach to Yesod</strong><br/>
          <strong>Shape & Meaning:</strong> Nun is curved like a fish or bent like one who bows. Nun Sofit (×Ÿ) descends deep below the line.<br/>
          <strong>Gematria:</strong> 50 - Fish (× ×•Ö¼×Ÿâ€”nun), Jubilee (50th year), falling and rising, humility<br/>
          <strong>Path:</strong> Continuous movement from Victory (Netzach) to Foundation (Yesod)â€”persistent flow of divine energy.<br/><br/>
          ğŸ“– <strong>From Psalms:</strong> "The Lord upholds all who <em>fall</em> (× ×•Ö¹×¤Ö°×œÖ´×™×) and raises up all who are bowed down (×›Ö°Ö¼×¤×•Ö¼×¤Ö´×™×)." The Nun represents both the falling and the risingâ€”the fish that swims continuously without stopping.<br/>
          <a href="https://www.sefaria.org/Psalms.145.14" target="_blank" style="color: #FFD700;">ğŸ“š Psalms 145:14</a><br/><br/>
          ğŸŸ The nun-fish never sleeps, always moving in hidden waters. So too, divine providence constantly flows (Netzach) toward manifestation (Yesod), even when unseen. Nun teaches: even in falling, we are upheld by the Faithful One (× Ö¶×Ö±×Ö¸×Ÿâ€”ne'eman).`,
        
        '×¡': `<strong>Samech (×¡): Path Tiferet to Hod</strong><br/>
          <strong>Shape & Meaning:</strong> Samech is a perfect circle or squareâ€”complete, supportive, protective.<br/>
          <strong>Gematria:</strong> 60 - Support (×¡×•Ö¹×Öµ×šÖ°â€”somech), to uphold, encircle<br/>
          <strong>Path:</strong> Divine support flowing from Beauty (Tiferet) to Glory (Hod)â€”sustaining and upholding.<br/><br/>
          ğŸ“– <strong>From Psalms:</strong> "The Lord <em>supports</em> (×¡×•Ö¹×Öµ×šÖ°) all who fall and raises all who are bowed down." The Samech is God's supporting hand beneath us!<br/>
          <a href="https://www.sefaria.org/Psalms.145.14" target="_blank" style="color: #FFD700;">ğŸ“š Psalms 145:14</a><br/><br/>
          â­• Samech is the only letter with no openingâ€”fully enclosed, representing God's complete protection. It teaches: when we acknowledge divine glory (Hod) flowing from divine beauty (Tiferet), we are surrounded by infinite support.`,

        '×¢': `<strong>Ayin (×¢): Path Binah to Tiferet</strong><br/>
          <strong>Shape & Meaning:</strong> Ayin looks like an eye with a dot (the pupil) and a stemâ€”symbolizing vision and insight.<br/>
          <strong>Gematria:</strong> 70 - Eye (×¢Ö·×™Ö´×Ÿâ€”ayin), the 70 nations, the 70 faces of Torah, wellspring (×Ö·×¢Ö°×™Ö¸×Ÿâ€”mayan)<br/>
          <strong>Path:</strong> The discerning eye connecting Understanding (Binah) to Beauty (Tiferet)â€”perception that reveals harmony.<br/><br/>
          ğŸ“– <strong>From Proverbs:</strong> "The eye is never satisfied with seeing." Yet the spiritual eye (Ayin) can perceive divine beauty (Tiferet) emerging from deep understanding (Binah).<br/>
          <a href="https://www.sefaria.org/Proverbs.27.20" target="_blank" style="color: #FFD700;">ğŸ“š Proverbs 27:20</a><br/><br/>
          ğŸ‘ï¸ Ayin also means "nothingness" (×Ö·×™Ö´×Ÿ)â€”teaching that true spiritual vision comes from emptying the ego. When we see with Binah's insight rather than surface perception, we behold Tiferet's truth. The 70 faces of Torah all converge in the One.`,
        
        '×¤': `<strong>Peh (×¤): Path Gevurah to Hod</strong><br/>
          <strong>Shape & Meaning:</strong> Peh is an open mouth ready to speak. Peh Sofit (×£) descends, representing speech that goes inward.<br/>
          <strong>Gematria:</strong> 80 - Mouth (×¤Ö¶Ö¼×”â€”peh), speech, expression, opening<br/>
          <strong>Path:</strong> The mouth articulating Strength (Gevurah) into Glory (Hod)â€”disciplined speech becomes praise.<br/><br/>
          ğŸ“– <strong>From Psalms:</strong> "Lord, open my lips (×©Ö°×‚×¤Ö¸×ªÖ·×™ ×ªÖ´Ö¼×¤Ö°×ªÖ¸Ö¼×—), and my <em>mouth</em> (×¤Ö´Ö¼×™) will declare Your praise." Speech must be opened by Godâ€”only then does Gevurah's judgment become Hod's glory.<br/>
          <a href="https://www.sefaria.org/Psalms.51.17" target="_blank" style="color: #FFD700;">ğŸ“š Psalms 51:17</a><br/><br/>
          ğŸ—£ï¸ Peh teaches the power of words! Harsh speech (unrefined Gevurah) can wound, but when refined through humility (Hod), our words become vessels of divine glory. The Peh that descends (×£) represents speech that turns inward in contemplation before emerging as praise.`,
        
        '×¦': `<strong>Tzadi (×¦): Path Gevurah to Tiferet</strong><br/>
          <strong>Shape & Meaning:</strong> Tzadi is formed by a Nun (× ) attached to a Yud (×™)â€”the humble one bowing before the divine hand.<br/>
          <strong>Gematria:</strong> 90 - Righteous one (×¦Ö·×“Ö´Ö¼×™×§â€”tzadik), justice, fish-hook<br/>
          <strong>Path:</strong> The righteous path from Strength (Gevurah) to Beauty (Tiferet)â€”justice perfected in balance.<br/><br/>
          ğŸ“– <strong>From Proverbs:</strong> "The <em>righteous one</em> (×¦Ö·×“Ö´Ö¼×™×§) is the foundation of the world." This is the path of the Tzadik who brings Gevurah's judgment into perfect harmony (Tiferet).<br/>
          <a href="https://www.sefaria.org/Proverbs.10.25" target="_blank" style="color: #FFD700;">ğŸ“š Proverbs 10:25</a><br/><br/>
          âš–ï¸ The Tzadik is one who has mastered the balance of judgment and compassionâ€”using Gevurah's discipline not for harshness but for creating Tiferet's beauty. Like a fish-hook, the Tzadik draws souls upward toward the light.`,
        
        '×§': `<strong>Kuf (×§): Path Binah to Chesed</strong><br/>
          <strong>Shape & Meaning:</strong> Kuf descends below the baselineâ€”representing descent, holiness (×§Ö¹×“Ö¶×©×â€”kodesh), or the back of the head.<br/>
          <strong>Gematria:</strong> 100 - Holy (×§Ö¸×“×•Ö¹×©×â€”kadosh), monkey (×§×•Ö¹×£â€”kof, one who imitates), call (×§×•Ö¹×œâ€”kol)<br/>
          <strong>Path:</strong> The challenging path from Understanding (Binah) to Loving-kindness (Chesed)â€”descending to uplift.<br/><br/>
          ğŸ“– <strong>From Leviticus:</strong> "You shall be <em>holy</em> (×§Ö°×“Ö¹×©Ö´××™×), for I the Lord your God am holy (×§Ö¸×“×•Ö¹×©×)." True holiness (Binah's discernment) overflows as boundless compassion (Chesed).<br/>
          <a href="https://www.sefaria.org/Leviticus.19.2" target="_blank" style="color: #FFD700;">ğŸ“š Leviticus 19:2</a><br/><br/>
          ğŸµ Kuf descends below the lineâ€”sometimes representing <em>kedushah</em> (holiness) that stoops low to raise others up, sometimes <em>kof</em> (monkey), the imitator who mimics without understanding. The path teaches: true Chesed emerges when Binah humbles itself, descending to meet those in need.`,
        
        '×¨': `<strong>Resh (×¨): Path Tiferet to Yesod</strong><br/>
          <strong>Shape & Meaning:</strong> Resh is a rounded head without the leg of Daletâ€”representing a head turned or a person of poverty (×¨Ö¸××©×â€”rosh, head; ×¨Ö¸×©×â€”rash, poor).<br/>
          <strong>Gematria:</strong> 200 - Head (×¨Ö¹××©×â€”rosh), beginning (×¨Öµ××©Ö´××™×ªâ€”reishit), poverty, renewal<br/>
          <strong>Path:</strong> The conscious choice flowing from Beauty (Tiferet) to Foundation (Yesod)â€”leading with the head.<br/><br/>
          ğŸ“– <strong>From Genesis:</strong> "In the <em>beginning</em> (×‘Ö°Ö¼×¨Öµ××©Ö´××™×ªâ€”bereishit)..." Resh is the head of creation, the renewal of purpose that grounds beauty into foundation.<br/>
          <a href="https://www.sefaria.org/Genesis.1.1" target="_blank" style="color: #FFD700;">ğŸ“š Genesis 1:1</a><br/><br/>
          ğŸ‘¤ Resh turned one way is a <em>head</em> (leadership, renewal); turned another it is <em>poverty</em> (emptiness, need). This path teaches: true foundation (Yesod) requires bringing our highest consciousness (Tiferet) into every actâ€”leading with wisdom, not ego.`,

        '×©': `<strong>Shin (×©): Path Binah to Chochmah</strong><br/>
          <strong>Shape & Meaning:</strong> Shin has three heads/flames reaching upwardâ€”representing fire, the divine Name, and the three pillars of the Tree.<br/>
          <strong>Gematria:</strong> 300 - Fire (×Öµ×©×â€”esh), tooth (×©Öµ××Ÿâ€”shen), one of the Three Mother Letters<br/>
          <strong>Path:</strong> The blazing fire connecting Understanding (Binah) to Wisdom (Chochmah)â€”fusion of insight.<br/><br/>
          ğŸ“– <strong>From Sefer Yetzirah:</strong> "He made the letter Shin reign over <em>Fire</em>, and He bound to it a crown. He combined them one with another. With them He sealed the <em>heavens</em> in the World, <em>heat</em> in the Year, and the <em>head</em> in the Personâ€”the fire of divine wisdom that illuminates consciousness."<br/>
          <a href="https://www.sefaria.org/Sefer_Yetzirah.3.8" target="_blank" style="color: #FFD700;">ğŸ“š Sefer Yetzirah 3:8</a><br/><br/>
          ğŸ”¥ <strong>Three Mother Letters:</strong> Along with Aleph (×â€”Air) and Mem (×â€”Water), Shin (×©â€”Fire) forms the foundation of creation. Shin's three flames represent the three columns of the Tree: Right (Chesed), Left (Gevurah), and Center (Tiferet). When Binah (Understanding) and Chochmah (Wisdom) unite through Shin's fire, the blazing insight of <em>da'at</em> (knowledge) is born!<br/><br/>
          âœ¡ï¸ Shin appears on the mezuzah and tefillin, representing God's Name <em>Shaddai</em> (×©Ö·××“Ö·Ö¼×™)â€”the Almighty who sets boundaries (×©Ö¶×Ö¾×“Ö·Ö¼×™: "Who said 'Enough!'"). Fire that knows its limits becomes holy light.`,
        
        '×ª': `<strong>Tav (×ª): Path Yesod to Malchut</strong><br/>
          <strong>Shape & Meaning:</strong> Tav is formed by a Dalet (×“) and Nun (× ) joinedâ€”representing judgment (×“Ö´Ö¼×™×Ÿâ€”din) and humility (× Ö¸×›×•Ö¹×Ÿâ€”nachon) sealed together. It is the final letter, the seal.<br/>
          <strong>Gematria:</strong> 400 - Truth (×Ö±×Ö¶×ªâ€”emet), mark/seal (×ªÖ¸Ö¼×•â€”tav), completion<br/>
          <strong>Path:</strong> The final seal connecting Foundation (Yesod) to Kingdom (Malchut)â€”actualizing all in reality.<br/><br/>
          ğŸ“– <strong>From Ezekiel:</strong> "Go through the city and put a <em>mark</em> (×ªÖ¸Ö¼×•â€”tav) on the foreheads of those who sigh and groan..." The Tav is God's seal of protection and truth!<br/>
          <a href="https://www.sefaria.org/Ezekiel.9.4" target="_blank" style="color: #FFD700;">ğŸ“š Ezekiel 9:4</a><br/><br/>
          âœï¸ <strong>The Seal of Truth:</strong> The word <em>Emet</em> (×Ö±×Ö¶×ªâ€”truth) begins with Aleph (×), the first letter, includes Mem (×) in the middle, and ends with Tav (×ª)â€”spanning from beginning to end. But remove the Aleph (the Divine) and you have <em>Met</em> (×Öµ×ªâ€”death). Only with God (Aleph) does the seal (Tav) carry true life!<br/><br/>
          ğŸŒ Tav completes the journey from Yesod (spiritual foundation) into Malchut (physical manifestation). Every divine emanation from the highest Crown (Keter) now becomes actualâ€”sealed with the Tav of <em>truth</em> in this world. This is the final letterâ€”the signature of Creation complete!`
      };

      // YOUR ORIGINAL SEFIROT MAP FOR KEYWORD DIAGNOSIS
      const sefirotMap = [
        {
          name: "Keter",
          keywords: ["no will", "empty", "directionless", "disconnected from hashem", "no purpose", "meaningless", "lost", "aimless"],
          insight: `
            ğŸ‘‘ <strong>Keter Imbalance - Crown</strong><br/><br/>
            <strong>Symptoms:</strong> Loss of purpose, apathy, disconnection from divine will<br/>
            <strong>Animal Soul:</strong> Feeling empty, directionless<br/>
            <strong>Godly Soul:</strong> Deep will (ratzon) and delight (oneg) in divine unity<br/><br/>
            âœ¨ <strong>About Keter:</strong> The highest Sefirah, representing divine will, pure consciousness, and infinite light. It is the crownâ€”the transcendent root of all Sefirot, containing both Will and Delight.<br/><br/>
            ï¿½ <strong>Sacred Sources:</strong><br/>
            â€¢ <a href="https://www.sefaria.org/Zohar.1.15a" target="_blank" style="color: #FFD700; text-decoration: underline;">Zohar I:15a</a> - "Keter is the hidden will (ratzon), concealed and unknowable"<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_Yetzirah.1.1" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer Yetzirah 1:1</a> - "Ten Sefirot of Nothingnessâ€”Keter is the first, beyond comprehension"<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_HaBahir.106" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer HaBahir 106</a> - "The Crown is the will that preceded all thought"<br/><br/>
            ğŸ’¡ <strong>Healing Path:</strong> Meditate on purpose. Accept inner stillness. Surrender to higher will. Click on the golden Keter sphere to learn more!
          `
        },
        {
          name: "Chochmah",
          keywords: ["confused", "no insight", "mental block", "frozen", "can't think", "unclear", "foggy", "bewildered"],
          insight: `
            ğŸ’¡ <strong>Chochmah Imbalance - Wisdom</strong><br/><br/>
            <strong>Symptoms:</strong> Confusion, mental blocks, lack of clarity, frozen thinking<br/>
            <strong>Animal Soul:</strong> Rashness, impulsive actions without reflection<br/>
            <strong>Godly Soul:</strong> Flash of divine insight, intuitive knowing, pure wisdom<br/><br/>
            ğŸŒŸ <strong>About Chochmah:</strong> The first flash of an idea, pure undifferentiated wisdom. It is the initial spark of creation, the point of emanation from Keterâ€”the "Father" principle.<br/><br/>
            ï¿½ <strong>Sacred Sources:</strong><br/>
            â€¢ <a href="https://www.sefaria.org/Zohar.1.31a" target="_blank" style="color: #FFD700; text-decoration: underline;">Zohar I:31a</a> - "Chochmah is the beginning point, the flash of insight beyond words"<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_Yetzirah.1.5" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer Yetzirah 1:5</a> - "Flash of lightningâ€”this is Chochmah"<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_HaBahir.139" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer HaBahir 139</a> - "Wisdom (Chochmah) is the Fatherâ€”the seed of all thought"<br/><br/>
            ğŸ’¡ <strong>Healing Path:</strong> Contemplate Divine ideas. Ground insights in quiet reflection. Study Torah. Be open to sudden revelation. Click on the golden Chochmah sphere to explore deeper!
          `
        },
        {
          name: "Binah",
          keywords: ["overthinking", "mental loops", "no understanding", "too much logic", "anxiety", "analysis paralysis", "worried", "stressed", "obsessing"],
          insight: `
            ğŸ§  <strong>Binah Imbalance - Understanding</strong><br/><br/>
            <strong>Symptoms:</strong> Overthinking, mental loops, excessive analysis, anxiety<br/>
            <strong>Animal Soul:</strong> Over-analysis, rigidity, critical mindset<br/>
            <strong>Godly Soul:</strong> Discernment, deep understanding, teshuvah (return)<br/><br/>
            ğŸ•Šï¸ <strong>About Binah:</strong> The expansion of Chochmah into detailed understanding, giving form and structure. It represents divine motherly nurturing, discernmentâ€”the "Mother" principle forming the intellectual triad with Keter and Chochmah.<br/><br/>
            ï¿½ <strong>Sacred Sources:</strong><br/>
            â€¢ <a href="https://www.sefaria.org/Zohar.2.63b" target="_blank" style="color: #FFD700; text-decoration: underline;">Zohar II:63b</a> - "Binah is the palace where wisdom takes form"<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_Yetzirah.1.4" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer Yetzirah 1:4</a> - "Understand with Wisdom, be wise with Understanding"<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_HaBahir.141" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer HaBahir 141</a> - "Binah is the Motherâ€”giving form to the Father's seed"<br/><br/>
            ğŸ’¡ <strong>Healing Path:</strong> Practice compassion toward yourself. Reflect before reacting. Use reason WITH mercy. Breathe. Click on the golden Binah sphere for more guidance!
          `
        },
        {
          name: "Chesed",
          keywords: ["codependent", "no boundaries", "giving too much", "doormat", "people pleasing", "overgiving", "enabling", "can't say no"],
          insight: `
            ğŸ’™ <strong>Chesed Imbalance - Loving-kindness</strong><br/><br/>
            <strong>Symptoms:</strong> Codependency, giving to a fault, lack of boundaries, people-pleasing<br/>
            <strong>Animal Soul:</strong> Enabling, giving from fear or guilt<br/>
            <strong>Godly Soul:</strong> Pure expansive love, boundless grace, divine generosity<br/><br/>
            ğŸ’– <strong>About Chesed:</strong> Expansive love, boundless grace, mercy, and benevolence. The outpouring of divine goodness extending without limitâ€”the "Greatness" of God.<br/><br/>
            ï¿½ <strong>Sacred Sources:</strong><br/>
            â€¢ <a href="https://www.sefaria.org/Zohar.2.162a" target="_blank" style="color: #FFD700; text-decoration: underline;">Zohar II:162a</a> - "Chesed is the right armâ€”extending without measure"<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_Yetzirah.3.5" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer Yetzirah 3:5</a> - "Water flows from Chesedâ€”blessing all creation"<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_HaBahir.115" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer HaBahir 115</a> - "Chesed without Gevurah leads to chaos"<br/><br/>
            ğŸ’¡ <strong>Healing Path:</strong> Give from love, not fear. Let giving be guided by light, not guilt. Balance Chesed with Gevurah's boundaries. Click the golden Chesed sphere to learn more!
          `
        },
        {
          name: "Gevurah",
          keywords: ["anger", "rage", "harsh", "judgment", "critical", "control", "rigid", "frustrated", "impatient", "mean", "aggressive", "temper", "bad temper", "explosive", "irritable", "hostile", "furious"],
          insight: `
            âš¡ <strong>Gevurah Imbalance - Strength/Justice</strong><br/><br/>
            <strong>Symptoms:</strong> Harshness, anger, excessive judgment, need for control<br/>
            <strong>Animal Soul:</strong> Rage, criticism, suppression<br/>
            <strong>Godly Soul:</strong> Holy boundaries, discernment, strength with discipline<br/><br/>
            ğŸ›¡ï¸ <strong>About Gevurah:</strong> Restraint, discipline, judgment, and severity. It limits Chesed, providing structure for balance and justice in creationâ€”the "Might" of God.<br/><br/>
            ï¿½ <strong>Sacred Sources:</strong><br/>
            â€¢ <a href="https://www.sefaria.org/Zohar.2.23b" target="_blank" style="color: #FFD700; text-decoration: underline;">Zohar II:23b</a> - "Gevurah is the left armâ€”restraining and limiting with holy fire"<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_Yetzirah.3.6" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer Yetzirah 3:6</a> - "Fire reigns in Gevurahâ€”purifying through restriction"<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_HaBahir.162" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer HaBahir 162</a> - "Without Gevurah, Chesed would overflowâ€”boundaries create vessels"<br/><br/>
            ğŸ’¡ <strong>Healing Path:</strong> Set firm YET loving boundaries. Channel strength toward justice, not control. Balance judgment with compassion. Click the golden Gevurah sphere for deeper wisdom!
          `
        },
        {
          name: "Tiferet",
          keywords: ["disconnected from truth", "emotional chaos", "self-neglect", "unbalanced", "no center", "heartbroken", "sad", "depressed", "depression", "lonely", "despair", "hopeless", "empty inside"],
          insight: `
            âœ¨ <strong>Tiferet Imbalance - Beauty/Harmony</strong><br/><br/>
            <strong>Symptoms:</strong> Disconnection from truth, emotional chaos, lack of center<br/>
            <strong>Animal Soul:</strong> Self-neglect, inner contradiction<br/>
            <strong>Godly Soul:</strong> Harmony, compassion, truth, perfect balance<br/><br/>
            ğŸŒ <strong>About Tiferet:</strong> The central Sefirah! Harmony, compassion, truth, and balance. It reconciles Chesed and Gevurahâ€”the "Son" or "King" principle, representing the beauty of God's perfect balance.<br/><br/>
            ï¿½ <strong>Why Tiferet Relates to Depression/Sadness:</strong><br/>
            â€¢ <a href="https://www.sefaria.org/Zohar.3.231b" target="_blank" style="color: #FFD700; text-decoration: underline;">Zohar, Parashat Pinchas</a> - "When Tiferet is darkened, the heart is broken and joy departs"<br/>
            â€¢ <a href="https://www.sefaria.org/Tanya,_Iggeret_HaKodesh.11" target="_blank" style="color: #FFD700; text-decoration: underline;">Tanya, Iggeret HaKodesh Ch. 11</a> - Depression comes from disconnection to one's divine center (Tiferet)<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_Yetzirah.1.4" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer Yetzirah 1:4</a> - The heart corresponds to Tiferet, the seat of emotions<br/>
            â€¢ <a href="https://www.sefaria.org/Etz_Chaim,_Shaar_HaKlalim.3" target="_blank" style="color: #FFD700; text-decoration: underline;">Etz Chaim, Shaar HaKlalim Ch. 3</a> - Tiferet balances all emotions; its imbalance causes sadness<br/><br/>
            ğŸ’¡ <strong>Practical Healing Steps:</strong><br/>
            1. <strong>Center yourself:</strong> Daily heart-focused meditationâ€”place hand on heart, breathe, feel your divine spark<br/>
            2. <strong>Balance opposites:</strong> Practice giving (Chesed) and receiving (Gevurah) equally<br/>
            3. <strong>Study Torah:</strong> Called "Etz Chaim" (Tree of Life)â€”connects directly to Tiferet<br/>
            4. <strong>Sunlight exposure:</strong> Sun is Tiferet's planetâ€”15 minutes daily in morning light<br/>
            5. <strong>Truth practice:</strong> Journal one honest feeling dailyâ€”Tiferet is the Sefirah of truth (Emet)<br/><br/>
            ğŸŒ³ <strong>Next Step:</strong> Click the golden Tiferet sphere at the heart of the Tree for full wisdom!
          `
        },
        {
          name: "Netzach",
          keywords: ["quitting", "defeated", "can't keep going", "burned out", "giving up", "lazy", "procrastinating", "unmotivated", "no energy", "tired", "exhausted"],
          insight: `
            ğŸ”¥ <strong>Netzach Imbalance - Victory/Endurance</strong><br/><br/>
            <strong>Symptoms:</strong> Wanting to quit, feeling defeated, burnout, loss of persistence<br/>
            <strong>Animal Soul:</strong> Ego-driven domination or complete collapse<br/>
            <strong>Godly Soul:</strong> Holy endurance, perseverance, victory through faith<br/><br/>
            ğŸ¥‡ <strong>About Netzach:</strong> Endurance, perseverance, victory, and divine triumph. The drive to overcome obstacles and achieve goalsâ€”the "Eternity" of God.<br/><br/>
            ï¿½ <strong>Sacred Sources:</strong><br/>
            â€¢ <a href="https://www.sefaria.org/Zohar.3.75a" target="_blank" style="color: #FFD700; text-decoration: underline;">Zohar III:75a</a> - "Netzach is the eternal flowâ€”never ceasing, always persevering"<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_Yetzirah.4.6" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer Yetzirah 4:6</a> - "The right leg is Netzachâ€”moving forward with strength"<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_HaBahir.189" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer HaBahir 189</a> - "Victory comes from unending faith"<br/><br/>
            ğŸ’¡ <strong>Healing Path:</strong> Embrace sacred discipline. Align will with eternity. Trust your path. Click the golden Netzach sphere to renew your strength!
          `
        },
        {
          name: "Hod",
          keywords: ["shame", "self-hate", "doubt", "can't receive", "collapsed", "guilt"],
          insight: `
            ğŸŒˆ <strong>Hod Imbalance - Glory/Humility</strong><br/><br/>
            <strong>Symptoms:</strong> Shame, self-hatred, doubt, inability to receive, guilt<br/>
            <strong>Animal Soul:</strong> Low self-worth, false humility, denial<br/>
            <strong>Godly Soul:</strong> Gratitude, true humility, surrender to the Divine<br/><br/>
            ğŸ“¿ <strong>About Hod:</strong> Humility, surrender, resonance, and divine glory. The receptive counterpart to Netzach, acknowledging the source of powerâ€”the "Glory" of God.<br/><br/>
            ï¿½ <strong>Sacred Sources:</strong><br/>
            â€¢ <a href="https://www.sefaria.org/Zohar.1.249a" target="_blank" style="color: #FFD700; text-decoration: underline;">Zohar I:249a</a> - "Hod is the echo of divine gloryâ€”receptive and grateful"<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_Yetzirah.4.7" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer Yetzirah 4:7</a> - "The left leg is Hodâ€”yielding in gratitude"<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_HaBahir.193" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer HaBahir 193</a> - "Glory comes through surrender to the Source"<br/><br/>
            ğŸ’¡ <strong>Healing Path:</strong> Honor your voice. Practice gratitude. Bow to the Divine, not to shame. Click the golden Hod sphere for healing wisdom!
          `
        },
        {
          name: "Yesod",
          keywords: ["scattered", "leaking energy", "unhealthy attachments", "disconnected", "integrity"],
          insight: `
            ğŸ’ <strong>Yesod Imbalance - Foundation</strong><br/><br/>
            <strong>Symptoms:</strong> Scattered energy, unhealthy attachments, emotional leakage<br/>
            <strong>Animal Soul:</strong> Dispersed focus, broken integrity<br/>
            <strong>Godly Soul:</strong> Sacred bonding, channeled energy, foundation of truth<br/><br/>
            ğŸŒ™ <strong>About Yesod:</strong> Connection, foundation, bonding, and transmission of divine energy to Malchut. The channel through which all preceding Sefirot flow into manifestationâ€”the "Foundation" of all existence.<br/><br/>
            ï¿½ <strong>Sacred Sources:</strong><br/>
            â€¢ <a href="https://www.sefaria.org/Zohar.1.59a" target="_blank" style="color: #FFD700; text-decoration: underline;">Zohar I:59a</a> - "Yesod is the righteous one (tzadik)â€”foundation of the world"<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_Yetzirah.1.8" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer Yetzirah 1:8</a> - "Foundation binds all Sefirotâ€”the covenant of connection"<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_HaBahir.172" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer HaBahir 172</a> - "Through Yesod, all flows from heaven to earth"<br/><br/>
            ğŸ’¡ <strong>Healing Path:</strong> Create holy connections. Strengthen personal integrity. Channel energy toward truth. Click the golden Yesod sphere to ground yourself!
          `
        },
        {
          name: "Malchut",
          keywords: ["powerless", "unseen", "disconnected from action", "passive", "no voice"],
          insight: `
            ğŸ‘‘ğŸŒ <strong>Malchut Imbalance - Kingdom/Presence</strong><br/><br/>
            <strong>Symptoms:</strong> Feeling powerless, unseen, unable to act or manifest<br/>
            <strong>Animal Soul:</strong> Passivity, victimhood<br/>
            <strong>Godly Soul:</strong> Divine feminine presence (Shekhinah), receptivity with dignity<br/><br/>
            ğŸŒ <strong>About Malchut:</strong> The physical world, manifest reality, and the divine feminine presence (Shekhinah). The culmination of all divine emanations, where divinity is experienced in creationâ€”the "Kingdom" of God.<br/><br/>
            ï¿½ <strong>Sacred Sources:</strong><br/>
            â€¢ <a href="https://www.sefaria.org/Zohar.1.21a" target="_blank" style="color: #FFD700; text-decoration: underline;">Zohar I:21a</a> - "Malchut is the Shekhinahâ€”divine presence dwelling in the world"<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_Yetzirah.1.13" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer Yetzirah 1:13</a> - "Earth is Malchutâ€”where heaven and earth unite"<br/>
            â€¢ <a href="https://www.sefaria.org/Sefer_HaBahir.22" target="_blank" style="color: #FFD700; text-decoration: underline;">Sefer HaBahir 22</a> - "The Kingdom receives all light and reflects it back"<br/><br/>
            ğŸ’¡ <strong>Healing Path:</strong> Step into spiritual leadership. Receive with dignity. Speak your truth. Take grounded action. Embody divine presence in this world. Click the golden Malchut sphere at the base of the Tree!
          `
        },
        {
          name: "Genesis 3:22",
          keywords: ["tree of life", "live forever", "genesis 3:22"],
          insight: `
            ğŸ“– <strong>Genesis 3:22 - The Tree of Life</strong><br/><br/>
            "And the Lord God said, 'Behold, the man is become as one of us, to know good and evil; and now, lest he put forth his hand, and take also of the tree of life, and eat, and live forever..."<br/><br/>
            ğŸŒ³ <strong>Sefirah Connection:</strong> <strong>Yesod</strong> (Foundation) and <strong>Malchut</strong> (Kingdom/Shekhinah)<br/><br/>
            In Jewish mystical tradition, the <strong>Tree of Life</strong> is the structure of the Sefirot, especially the central column (Keter â†’ Tiferet â†’ Yesod â†’ Malchut).<br/><br/>
            - <strong>Yesod</strong> channels divine energy from above into the world below â€” it is the <em>tzadik</em>, the foundation of the world.<br/>
            - <strong>Malchut</strong> is the vessel and final receiver of all divine influence â€” the realm of manifestation and presence.<br/><br/>
            ğŸƒ <strong>Insight:</strong> After the sin, access to eternal life (the pure, direct flow from Yesod to Malchut) was cut off. The unity was fractured.<br/><br/>
            ğŸ•¯ï¸ <strong>Healing:</strong> Restoration of this flow comes through rectifying Yesod (foundation, purity) and elevating Malchut (faithful presence) to once again receive from the Tree of Life.
          `
        }
      ];

      // DIAGNOSTIC FUNCTION - USES YOUR SEFIROT MAP AND ALEPH-BET
      function diagnoseSefirah(userInput) {
        const input = userInput.toLowerCase();
        
        // First check for Hebrew letters (Aleph-Bet)
        const hebrewLetterNames = {
          'aleph': '×', 'alef': '×',
          'bet': '×‘', 'beit': '×‘', 'vet': '×‘',
          'gimmel': '×’', 'gimel': '×’',
          'dalet': '×“', 'daled': '×“',
          'heh': '×”', 'hey': '×”', 'he': '×”',
          'vav': '×•', 'vov': '×•', 'waw': '×•',
          'zayin': '×–',
          'chet': '×—', 'het': '×—', 'khet': '×—',
          'tet': '×˜',
          'yud': '×™', 'yod': '×™',
          'kaf': '×›', 'chaf': '×›',
          'lamed': '×œ',
          'mem': '×',
          'nun': '× ',
          'samech': '×¡', 'samekh': '×¡',
          'ayin': '×¢', 'ayn': '×¢',
          'peh': '×¤', 'pey': '×¤', 'feh': '×¤',
          'tzadi': '×¦', 'tsadi': '×¦', 'tzadik': '×¦',
          'kuf': '×§', 'quf': '×§', 'kof': '×§',
          'resh': '×¨', 'reish': '×¨',
          'shin': '×©',
          'taf': '×ª', 'tav': '×ª'
        };
        
        // Check if user is asking about a Hebrew letter
        for (let [name, letter] of Object.entries(hebrewLetterNames)) {
          if (input.includes(name) || input.includes(letter)) {
            if (contentMapAlephBet[letter]) {
              return contentMapAlephBet[letter];
            }
          }
        }
        
        // Then check for Sefirot keywords
        for (let sefirah of sefirotMap) {
          if (sefirah.keywords.some(kw => input.includes(kw))) {
            return sefirah.insight;
          }
        }
        // If no keyword match, return a specific string to signal fallback
        return "NO_DIAGNOSIS_MATCH";
      }

      // Function to handle chatbot responses using LLM - Primary: Gemini, Backup: ChatGPT, Final Fallback: Local
      async function getBotResponse(userMessage) {
        chatbotLoading.classList.remove("hidden"); // Show loading indicator
        
        // Try Gemini first
        const geminiResponse = await tryGeminiAPI(userMessage);
        if (geminiResponse !== null) {
          chatbotLoading.classList.add("hidden");
          return geminiResponse;
        }
        
        // If Gemini fails, fallback to ChatGPT
        console.log("Gemini failed, falling back to ChatGPT...");
        const chatGPTResponse = await tryChatGPTAPI(userMessage);
        if (chatGPTResponse !== null) {
          chatbotLoading.classList.add("hidden");
          return chatGPTResponse;
        }
        
        // If both APIs fail (local development), provide local response
        console.log("Both APIs failed, using local fallback...");
        chatbotLoading.classList.add("hidden");
        return getLocalFallbackResponse(userMessage);
      }
      
      // Local fallback for development when APIs aren't available
      function getLocalFallbackResponse(userMessage) {
        const lowerMessage = userMessage.toLowerCase();
        
        // First, try the keyword diagnosis system - this is your core feature!
        const diagnosisResult = diagnoseSefirah(userMessage);
        if (diagnosisResult !== "NO_DIAGNOSIS_MATCH") {
          return diagnosisResult;
        }
        
        // Smart pattern matching for common struggles
        if (lowerMessage.match(/\b(i'?m?|i am|feeling|feel)\s+(lazy|tired|exhausted|unmotivated|procrastinat|no energy)\b/)) {
          // Find Netzach in sefirotMap
          const netzach = sefirotMap.find(s => s.name === "Netzach");
          if (netzach) return netzach.insight;
        }
        
        if (lowerMessage.match(/\b(angry|mad|furious|irritated|annoyed|rage|temper|hostile|aggressive)\b/)) {
          const gevurah = sefirotMap.find(s => s.name === "Gevurah");
          if (gevurah) return gevurah.insight;
        }
        
        if (lowerMessage.match(/\b(sad|depressed|down|unhappy|heartbroken)\b/)) {
          const tiferet = sefirotMap.find(s => s.name === "Tiferet");
          if (tiferet) return tiferet.insight;
        }
        
        if (lowerMessage.match(/\b(anxious|worried|stress|panic)\b/)) {
          const binah = sefirotMap.find(s => s.name === "Binah");
          if (binah) return binah.insight;
        }
        
        // Check for sacred text queries
        if (lowerMessage.includes('zohar') || lowerMessage.includes('male and female') || lowerMessage.includes('unity')) {
          return `ğŸ“– <strong>From the Zohar:</strong><br/>"Male and female He created themâ€”any image where male and female are not found is not a high image... In any place where male and female are not found as one, The Holy One does not rest His dwelling in that place. And blessings are not found except in a place where male and female are found."<br/><br/>âœ¨ <strong>What this means for you:</strong><br/>This teaches us about divine unity and balance - just as the Sefirot need both masculine and feminine energies (like Chesed and Gevurah, or Netzach and Hod), so too does spiritual wholeness require integration of all aspects of ourselves.<br/><br/>ğŸŒŸ <strong>Practical steps:</strong><br/>1. Explore <strong>Chesed</strong> (loving-kindness) and <strong>Gevurah</strong> (discipline) on the Tree<br/>2. Notice how they balance each other - too much mercy without boundaries is chaos<br/>3. Ask me: "What's the balance between Chesed and Gevurah?"<br/><br/>ğŸ“š <a href="https://www.sefaria.org/Zohar" target="_blank" style="color: #FFD700; text-decoration: underline;">Read more from the Zohar on Sefaria â†’</a>`;
        }
        
        if (lowerMessage.includes('sefer yetzirah') || lowerMessage.includes('letters') || lowerMessage.includes('creation')) {
          return `ğŸ“– <strong>From Sefer Yetzirah:</strong><br/>"Twenty-Two Letters of Foundationâ€”He carved them, and hewed them, and weighed them, and exchanged them, and combined them, and formed with them the soul of every formed being and the soul of every being He has yet to form."<br/><br/>ğŸ’« <strong>What this means for you:</strong><br/>The Hebrew letters you see on the Tree are not just symbols - they are the very tools through which God created reality! Each letter is a creative force that shapes existence.<br/><br/>ğŸŒŸ <strong>Explore the letters:</strong><br/>1. Click on any Hebrew letter (× ×‘ ×’...) on the paths between Sefirot<br/>2. Learn about its shape, gematria value, and mystical meaning<br/>3. Try asking: "Tell me about Alef" or "What is the shape of Bet?"<br/><br/>ğŸ“š <a href="https://www.sefaria.org/Sefer_Yetzirah" target="_blank" style="color: #FFD700; text-decoration: underline;">Study Sefer Yetzirah on Sefaria â†’</a>`;
        }
        
        if (lowerMessage.includes('sefer habahir') || lowerMessage.includes('bahir') || lowerMessage.includes('tree planted')) {
          return `ğŸ“– <strong>From Sefer HaBahir:</strong><br/>"I am the One who planted this tree in order that all the world should delight in it. And in it, I spread All. I called it All because all depend upon it, all emanate from it, and all need it. To it they look, for it they wait, and from it, souls fly in joy."<br/><br/>ğŸŒ³ <strong>What this means for you:</strong><br/>This IS the Tree of Life you're exploring right now! Every Sefirah (golden sphere) contains divine wisdom, and the entire structure is designed for your spiritual growth and delight.<br/><br/>ğŸŒŸ <strong>Start your journey:</strong><br/>1. Click on <strong>Keter</strong> (Crown) at the top - the source of infinite light<br/>2. Move down to <strong>Tiferet</strong> (Beauty) in the center - the heart of the Tree<br/>3. Explore <strong>Malchut</strong> (Kingdom) at the bottom - where heaven meets earth<br/>4. Ask me: "I'm feeling lost" or "I need guidance" for personalized wisdom<br/><br/>ğŸ“š <a href="https://www.sefaria.org/Sefer_HaBahir" target="_blank" style="color: #FFD700; text-decoration: underline;">Study Sefer HaBahir on Sefaria â†’</a>`;
        }
        
        if (lowerMessage.includes('three mothers') || lowerMessage.includes('alef') || lowerMessage.includes('mem') || lowerMessage.includes('shin')) {
          return `ğŸ“– <strong>The Three Mother Letters (Sefer Yetzirah):</strong><br/><br/>ğŸŒ¬ï¸ <strong>Alef (×)</strong> - Wind/Air: "He sealed the Wind in the world, and satiation in the Year, and the chest in the Person."<br/><br/>ğŸ’§ <strong>Mem (×)</strong> - Water: "He sealed the earth in the World, and cold in the Year, and the belly in the Person."<br/><br/>ğŸ”¥ <strong>Shin (×©)</strong> - Fire: "He sealed the heavens in the World, and heat in the Year, and the head in the Person."<br/><br/>ğŸŒŸ <strong>What this means for you:</strong><br/>These three letters form the foundation of all creation! They represent the three elements that make up reality itself - Air (balance), Water (flow), and Fire (transformation).<br/><br/>ğŸ’« <strong>Find them on the Tree:</strong><br/>1. Look for the Hebrew letters × × ×© on the paths connecting the Sefirot<br/>2. Click on each one to learn its full mystical meaning<br/>3. Try asking: "Tell me about Alef" or "What does Shin represent?"<br/><br/>ğŸ“š <a href="https://www.sefaria.org/Sefer_Yetzirah.3" target="_blank" style="color: #FFD700; text-decoration: underline;">Study the Three Mothers on Sefaria â†’</a>`;
        }
        
        // Check for Sefirot mentions with full content
        const sefirotResponses = {
          'keter': contentMapSefirah['Keter'],
          'chochmah': contentMapSefirah['Chochmah'],
          'binah': contentMapSefirah['Binah'],
          'chesed': contentMapSefirah['Chesed'],
          'gevurah': contentMapSefirah['Gevurah'],
          'tiferet': contentMapSefirah['Tiferet'],
          'netzach': contentMapSefirah['Netzach'],
          'hod': contentMapSefirah['Hod'],
          'yesod': contentMapSefirah['Yesod'],
          'malchut': contentMapSefirah['Malchut'],
          'malkuth': contentMapSefirah['Malchut']
        };
        
        for (const [key, response] of Object.entries(sefirotResponses)) {
          if (lowerMessage.includes(key)) {
            return response + '<br/><br/>ğŸ’¡ <em>Click on the golden sphere to explore more, or ask me about specific struggles to find which Sefirah can help you!</em>';
          }
        }
        
        // Emotional keyword matching from sefirotMap
        const emotionalKeywords = {
          'confused': sefirotMap[1].insight,
          'mental block': sefirotMap[1].insight,
          'overthinking': sefirotMap[2].insight,
          'anxiety': sefirotMap[2].insight,
          'sad': sefirotMap[3].insight,
          'lonely': sefirotMap[3].insight,
          'depressed': sefirotMap[3].insight,
          'anger': sefirotMap[4].insight,
          'rage': sefirotMap[4].insight,
          'harsh': sefirotMap[4].insight,
          'heartbroken': sefirotMap[5].insight,
          'compassion': sefirotMap[5].insight,
          'quitting': sefirotMap[6].insight,
          'defeated': sefirotMap[6].insight,
          'burnout': sefirotMap[6].insight,
          'shame': sefirotMap[7].insight,
          'doubt': sefirotMap[7].insight,
          'guilt': sefirotMap[7].insight
        };
        
        for (const [keyword, insight] of Object.entries(emotionalKeywords)) {
          if (lowerMessage.includes(keyword)) {
            return insight + '<br/><br/>ğŸŒ¿ <em>The Tree of Life offers healing for every soul-wound. Keep exploring!</em>';
          }
        }
        
        // Generic helpful responses
        if (lowerMessage.includes('help') || lowerMessage.includes('guide')) {
          return 'ğŸŒ¿ Shalom! I\'m your Mystic Guide through the Tree of Life. I can help you:<br/><br/>âœ¨ <strong>Understand the Sefirot</strong> - Ask about any Sefirah like "Tell me about Tiferet"<br/>ğŸ“– <strong>Share Sacred Wisdom</strong> - From the Zohar, Sefer Yetzirah, and Sefer HaBahir<br/>ğŸ’« <strong>Diagnose Soul Imbalances</strong> - Tell me what you\'re struggling with (anger, confusion, sadness, etc.)<br/>ğŸ”¤ <strong>Explain Hebrew Letters</strong> - Ask about any of the 22 letters on the paths<br/><br/>Click on the golden Sefirot or Hebrew letters to explore their mysteries!';
        }
        
        if (lowerMessage.includes('struggling') || lowerMessage.includes('problem') || lowerMessage.includes('issue')) {
          return 'ğŸ’™ I hear you. The Tree of Life is here to help heal soul-wounds. Tell me more specifically:<br/><br/>â€¢ Are you feeling confused, stuck, or blocked? (Chochmah/Binah)<br/>â€¢ Struggling with anger or being too harsh? (Gevurah)<br/>â€¢ Feeling sad, heartbroken, or disconnected? (Tiferet)<br/>â€¢ Experiencing shame or self-doubt? (Hod)<br/>â€¢ Feel like giving up or burned out? (Netzach)<br/><br/>Or just tell me in your own words what you\'re going through, and I\'ll identify which Sefirah needs attention. ğŸŒ¿';
        }
        
        // Default response with invitation to explore
        return `ğŸŒ¿ <strong>Shalom!</strong> Welcome to the Tree of Life - your guide to Kabbalistic wisdom.<br/><br/>ğŸŒŸ <strong>What you can explore:</strong><br/><br/>ğŸ“¿ <strong>The 10 Sefirot (Golden Spheres):</strong><br/>â€¢ Ask: "What is Chesed?" or "Tell me about Tiferet"<br/>â€¢ Click on any golden sphere to see its full wisdom<br/>â€¢ Each contains angels, constellations, and divine attributes<br/><br/>ğŸ”¤ <strong>The 22 Hebrew Letters (Paths):</strong><br/>â€¢ Ask: "What does the letter Alef mean?" or "Tell me about Bet"<br/>â€¢ Click any Hebrew letter (× ×‘ ×’...) to learn its shape and gematria<br/>â€¢ Discover teachings from Sefer Yetzirah and Sefer HaBahir<br/><br/>ğŸ’¬ <strong>Personal Guidance:</strong><br/>â€¢ Share how you feel: "I'm feeling confused", "I struggle with anger", "I'm feeling lazy"<br/>â€¢ Get personalized wisdom matched to your needs<br/><br/>ğŸ“š <strong>Sacred Texts:</strong><br/>â€¢ Ask about: "The Zohar", "Sefer Yetzirah", "Sefer HaBahir", "Three Mother Letters"<br/>â€¢ Get clickable links to study more on Sefaria<br/><br/>âœ¨ <em>Start anywhere - the Tree will guide you!</em> ğŸŒ³<br/><br/><small>ğŸ’¡ Note: Full AI wisdom available when deployed online - but all sacred teachings are built-in!</small>`;
      }

      // Primary API: Google Gemini via Netlify Function
      async function tryGeminiAPI(userMessage) {
        try {
          const response = await fetch('/.netlify/functions/gemini', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ input: userMessage })
          });

          if (!response.ok) {
            console.error("Gemini API Error:", response.status, response.statusText);
            return null; // Signal failure to try backup
          }

          const result = await response.json();
          if (result.candidates && result.candidates.length > 0 &&
              result.candidates[0].content && result.candidates[0].content.parts &&
              result.candidates[0].content.parts.length > 0) {
            return result.candidates[0].content.parts[0].text;
          } else {
            console.error("Unexpected Gemini response structure:", result);
            return null;
          }
        } catch (error) {
          console.error("Error calling Gemini API:", error);
          return null; // Signal failure to try backup
        }
      }

      // Backup API: OpenAI ChatGPT via Netlify Function
      async function tryChatGPTAPI(userMessage) {
        try {
          const response = await fetch('/.netlify/functions/chatgpt', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ input: userMessage })
          });

          if (!response.ok) {
            console.error("ChatGPT API Error:", response.status, response.statusText);
            return null; // Signal failure to use local fallback
          }

          const result = await response.json();
          if (result.message) {
            return result.message;
          } else {
            console.error("Unexpected ChatGPT response structure:", result);
            return null;
          }
        } catch (error) {
          console.error("Error calling ChatGPT API:", error);
          return null; // Signal failure to use local fallback
        }
      }

      // Event listener for chat input - now handles both diagnostic and LLM responses
      if (chatInput && chatContent) {
        chatInput.addEventListener("keydown", async (event) => {
          if (event.key === "Enter") {
            const msg = chatInput.value.trim();
            if (!msg) return;

            const userMsg = document.createElement("div");
            userMsg.textContent = "ğŸ—£ï¸ You: " + msg;
            chatContent.appendChild(userMsg);
            chatInput.value = ''; // Clear input immediately

            const botPlaceholder = document.createElement("div");
            botPlaceholder.classList.add("mt-1"); // Start with no italic/gray for easier replacement
            botPlaceholder.innerHTML = " Mystic Guide is thinking..."; // Will be replaced

            chatContent.appendChild(botPlaceholder);
            chatContent.scrollTop = chatContent.scrollHeight; // Scroll to bottom

            // Attempt rule-based diagnosis first
            let botResponseText = diagnoseSefirah(msg);

            if (botResponseText === "NO_DIAGNOSIS_MATCH") {
              // If no diagnosis, use LLM
              botPlaceholder.innerHTML = `<span class="text-gray-500 italic"> Mystic Guide is thinking...</span>`; // Show thinking state for LLM
              botResponseText = await getBotResponse(msg);
            } else {
                // If a diagnosis was made, remove thinking message or ensure it wasn't added for this path
                chatbotLoading.classList.add("hidden"); // Ensure loading is hidden for instant responses
            }

            // Update the bot's reply
            botPlaceholder.innerHTML = `ğŸŒ¿ Mystic Guide: ${botResponseText}`;
            botPlaceholder.classList.remove("text-gray-500", "italic"); // Remove thinking style
            chatContent.scrollTop = chatContent.scrollHeight; // Scroll to bottom again
          }
        });
      }

      // Toggle chat popup
      const guideLeaf = document.getElementById('guideLeaf');
      const chatPopup = document.getElementById('chat-popup');
      if (guideLeaf && chatPopup) {
        guideLeaf.addEventListener('click', () => {
          chatPopup.classList.toggle('hidden');
        });
      }

      // Sefirah click handlers
      document.querySelectorAll('.sefira').forEach(element => {
        const name = element.getAttribute("data-name");
        element.innerHTML = `<span class='text-white font-bold text-sm'>${name}</span>`;
        element.addEventListener('click', () => {
          if (currentOpen === `sefira-${name}`) { // Differentiate between Sefirah and Aleph-Bet
            popupBox.classList.add("hidden");
            currentOpen = null;
          } else {
            popupText.innerHTML = contentMapSefirah[name] || `${name} info coming soon.`;
            popupBox.classList.remove("hidden");
            currentOpen = `sefira-${name}`;
          }
        });
      });

      // Aleph-Bet click handlers
      document.querySelectorAll('.aleph-bet').forEach(element => {
        const letter = element.getAttribute("data-letter");
        element.addEventListener('click', () => {
          if (currentOpen === `letter-${letter}`) { // Differentiate between Sefirah and Aleph-Bet
            popupBox.classList.add("hidden");
            currentOpen = null;
          } else {
            popupText.innerHTML = contentMapAlephBet[letter] || `${letter} info coming soon.`;
            popupBox.classList.remove("hidden");
            currentOpen = `letter-${letter}`;
          }
        });
      });
    });
    // END OF CHATBOT AND INTERACTIVITY JAVASCRIPT CODE
  </script>
</head>
<body class="bg-cover bg-no-repeat bg-center font-serif" style="background-image: url('tree-of-life.webp');">
  <div class="background-stars"></div> <div class="dragonfly dragonfly-1"></div>
<div class="dragonfly dragonfly-2"></div>
<div class="dragonfly dragonfly-3"></div>

  <div id="app" class="relative flex flex-col items-center justify-center min-h-screen p-4">
    <div class="sefira absolute" style="top: 6%; left: 50%; transform: translate(-50%, -50%);" data-name="Keter">Keter</div>
    <div class="sefira absolute" style="top: 12%; left: 70%; transform: translate(-50%, -50%);" data-name="Chochmah">Chochmah</div>
    <div class="sefira absolute" style="top: 12%; left: 30%; transform: translate(-50%, -50%);" data-name="Binah">Binah</div>
    <div class="sefira absolute" style="top: 28%; left: 65%; transform: translate(-50%, -50%);" data-name="Chesed">Chesed</div>
    <div class="sefira absolute" style="top: 28%; left: 35%; transform: translate(-50%, -50%);" data-name="Gevurah">Gevurah</div>
    <div class="sefira absolute" style="top: 36%; left: 50%; transform: translate(-50%, -50%);" data-name="Tiferet">Tiferet</div>
    <div class="sefira absolute" style="top: 54%; left: 60%; transform: translate(-50%, -50%);" data-name="Netzach">Netzach</div>
    <div class="sefira absolute" style="top: 54%; left: 40%; transform: translate(-50%, -50%);" data-name="Hod">Hod</div>
    <div class="sefira absolute" style="top: 70%; left: 50%; transform: translate(-50%, -50%);" data-name="Yesod">Yesod</div>
    <div class="sefira absolute" style="top: 85%; left: 50%; transform: translate(-50%, -50%);" data-name="Malchut">Malchut</div>

    <div class="aleph-bet absolute z-50" data-letter="×" style="top:28%; left:50%;">×</div> <div class="aleph-bet absolute z-50" data-letter="×‘" style="top:20%; left:67.5%;">×‘</div> <div class="aleph-bet absolute z-50" data-letter="×’" style="top:20%; left:32.5%;">×’</div> <div class="aleph-bet absolute z-50" data-letter="×“" style="top:21%; left:50%;">×“</div> <div class="aleph-bet absolute z-50" data-letter="×”" style="top:7%; left:60%;">×”</div> <div class="aleph-bet absolute z-50" data-letter="×•" style="top:7%; left:40%;">×•</div> <div class="aleph-bet absolute z-50" data-letter="×–" style="top:20%; left:52.5%;">×–</div> <div class="aleph-bet absolute z-50" data-letter="×—" style="top:34%; left:57.5%;">×—</div> <div class="aleph-bet absolute z-50" data-letter="×˜" style="top:26%; left:60%;">×˜</div> <div class="aleph-bet absolute z-50" data-letter="×™" style="top:47%; left:55%;">×™</div> <div class="aleph-bet absolute z-50" data-letter="×›" style="top:41%; left:62.5%;">×›</div> <div class="aleph-bet absolute z-50" data-letter="×œ" style="top:62%; left:45%;">×œ</div> <div class="aleph-bet absolute z-50" data-letter="×" style="top:54%; left:50%;">×</div> <div class="aleph-bet absolute z-50" data-letter="× " style="top:62%; left:55%;">× </div> <div class="aleph-bet absolute z-50" data-letter="×¡" style="top:47%; left:45%;">×¡</div> <div class="aleph-bet absolute z-50" data-letter="×¢" style="top:26%; left:40%;">×¢</div> <div class="aleph-bet absolute z-50" data-letter="×¤" style="top:41%; left:37.5%;">×¤</div> <div class="aleph-bet absolute z-50" data-letter="×¦" style="top:34%; left:42.5%;">×¦</div> <div class="aleph-bet absolute z-50" data-letter="×§" style="top:20%; left:47.5%;">×§</div> <div class="aleph-bet absolute z-50" data-letter="×¨" style="top:58%; left:50%;">×¨</div> <div class="aleph-bet absolute z-50" data-letter="×©" style="top:12%; left:50%;">×©</div> <div class="aleph-bet absolute z-50" data-letter="×ª" style="top:77.5%; left:50%;">×ª</div> </div> <div id="popupBox" class="hidden absolute bottom-10 p-4 bg-white border border-yellow-500 rounded shadow-md z-40 max-w-md">
    <p id="popupText" class="text-sm text-gray-800"></p>
  </div>

  <div id="chat-popup" class="hidden absolute bottom-24 right-10 bg-white border-2 border-yellow-400 shadow-lg p-4 rounded-xl w-80 max-w-full z-50">
    <div class="font-bold text-purple-700 mb-2">ğŸŒ¿ Mystic Guide</div>
    <div id="chat-content" class="text-sm text-gray-800 h-40 overflow-y-auto mb-2">
      Shalom, I am your MysticMinded Guide ğŸŒ¿<br/>
      What Sefirah are you drawn to?<br/>
      Or tell me what you're struggling with, and Iâ€™ll help identify your soulâ€™s imbalances.
    </div>
    <input id="chat-input" type="text" placeholder="Type your question or struggle..." class="w-full border border-gray-300 rounded px-2 py-1" />
    <div id="chatbot-loading" class="hidden text-center text-gray-600 mt-2">
      Mystic Guide is thinking<span class="loading-dots"></span>
    </div>
  </div>
<img src="my logo updated.svg" id="guideLeaf" alt="MysticMinded Guide" class="w-28 h-28 object-contain cursor-pointer absolute top-[46%] left-1/2 transform -translate-x-1/2 z-[100] transition" style="pointer-events: auto;"/>
 

  <div id="guidanceArrow" style="position: absolute; top: 44%; left: calc(50% + 50px); transform: translateY(-50%); z-index: 101; display: flex; align-items: center; white-space: nowrap;">
  <div style="font-size: 1rem; color: #e7ca12; white-space: nowrap; margin-right: 5px;">Click here for guidance</div>
</div>

